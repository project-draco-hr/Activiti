{
  try {
    RestletFileUpload upload=new RestletFileUpload(new DiskFileItemFactory());
    List<FileItem> items=upload.parseRepresentation(representation);
    String variableScope=null;
    String variableName=null;
    String variableType=null;
    FileItem uploadItem=null;
    for (    FileItem fileItem : items) {
      if (fileItem.isFormField()) {
        if ("scope".equals(fileItem.getFieldName())) {
          variableScope=fileItem.getString("UTF-8");
        }
 else         if ("name".equals(fileItem.getFieldName())) {
          variableName=fileItem.getString("UTF-8");
        }
 else         if ("type".equals(fileItem.getFieldName())) {
          variableType=fileItem.getString("UTF-8");
        }
      }
 else       if (fileItem.getName() != null) {
        uploadItem=fileItem;
      }
    }
    if (uploadItem == null) {
      throw new ActivitiIllegalArgumentException("No file content was found in request body.");
    }
    if (variableName == null) {
      throw new ActivitiIllegalArgumentException("No variable name was found in request body.");
    }
    if (variableType != null) {
      if (!RestResponseFactory.BYTE_ARRAY_VARIABLE_TYPE.equals(variableType) && !RestResponseFactory.SERIALIZABLE_VARIABLE_TYPE.equals(variableType)) {
        throw new ActivitiIllegalArgumentException("Only 'binary' and 'serializable' are supported as variable type.");
      }
    }
 else {
      variableType=RestResponseFactory.BYTE_ARRAY_VARIABLE_TYPE;
    }
    RestVariableScope scope=RestVariableScope.LOCAL;
    if (variableScope != null) {
      scope=RestVariable.getScopeFromString(variableScope);
    }
    if (variableType.equals(RestResponseFactory.BYTE_ARRAY_VARIABLE_TYPE)) {
      ByteArrayOutputStream variableOutput=new ByteArrayOutputStream(((Long)uploadItem.getSize()).intValue());
      IOUtils.copy(uploadItem.getInputStream(),variableOutput);
      setVariable(execution,variableName,variableOutput.toByteArray(),scope,isNew);
    }
 else {
      ObjectInputStream stream=new ObjectInputStream(uploadItem.getInputStream());
      Object value=stream.readObject();
      setVariable(execution,variableName,value,scope,isNew);
      stream.close();
    }
    if (execution instanceof ProcessInstance) {
      return getApplication(ActivitiRestServicesApplication.class).getRestResponseFactory().createBinaryRestVariable(this,variableName,scope,variableType,null,null,execution.getId());
    }
 else {
      return getApplication(ActivitiRestServicesApplication.class).getRestResponseFactory().createBinaryRestVariable(this,variableName,scope,variableType,null,execution.getId(),null);
    }
  }
 catch (  FileUploadException fue) {
    throw new ResourceException(Status.CLIENT_ERROR_BAD_REQUEST,fue);
  }
catch (  IOException ioe) {
    throw new ResourceException(Status.CLIENT_ERROR_BAD_REQUEST,ioe);
  }
catch (  ClassNotFoundException ioe) {
    throw new ResourceException(Status.CLIENT_ERROR_UNSUPPORTED_MEDIA_TYPE.getCode(),"The provided body contains a serialized object for which the class is nog found: " + ioe.getMessage(),null,null);
  }
}
