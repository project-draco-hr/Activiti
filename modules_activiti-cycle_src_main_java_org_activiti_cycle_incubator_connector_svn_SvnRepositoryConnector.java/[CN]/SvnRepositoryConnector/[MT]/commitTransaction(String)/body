{
  transactionLock.lock();
  if (!transactionActive) {
    unlock();
    return;
  }
  ISVNClientAdapter clientAdapter=getSvnClientAdapter();
  try {
    clientAdapter.commit(dirtyFolders.values().toArray(new File[0]),comment,true);
  }
 catch (  SVNClientException e) {
    log.log(Level.SEVERE,"Could not commit changes in " + dirtyFolders.values().toArray(new File[0]) + " "+ e.getMessage());
    throw new RepositoryException("Could not commit changes in " + dirtyFolders.values().toArray(new File[0]),e);
  }
 finally {
    for (    File dirtyFolder : dirtyFolders.values()) {
      recDelete(dirtyFolder);
    }
    dirtyFolders.clear();
    createdFolders.clear();
    transactionActive=false;
    unlock();
  }
}
