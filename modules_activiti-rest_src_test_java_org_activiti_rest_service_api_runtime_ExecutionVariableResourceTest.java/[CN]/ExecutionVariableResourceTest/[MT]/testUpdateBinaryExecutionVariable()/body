{
  ProcessInstance processInstance=runtimeService.startProcessInstanceByKey("processOne",Collections.singletonMap("overlappingVariable",(Object)"processValue"));
  runtimeService.setVariableLocal(processInstance.getId(),"binaryVariable","Initial binary value".getBytes());
  Execution childExecution=runtimeService.createExecutionQuery().parentId(processInstance.getId()).singleResult();
  assertNotNull(childExecution);
  runtimeService.setVariableLocal(childExecution.getId(),"binaryVariable","Initial binary value child".getBytes());
  InputStream binaryContent=new ByteArrayInputStream("This is binary content".getBytes());
  Map<String,String> additionalFields=new HashMap<String,String>();
  additionalFields.put("name","binaryVariable");
  additionalFields.put("type","binary");
  Representation uploadRepresentation=new HttpMultipartRepresentation("value",binaryContent,additionalFields);
  ClientResource client=getAuthenticatedClient(RestUrls.createRelativeResourceUrl(RestUrls.URL_EXECUTION_VARIABLE,childExecution.getId(),"binaryVariable"));
  Representation response=client.put(uploadRepresentation);
  assertEquals(Status.SUCCESS_OK,client.getResponse().getStatus());
  JsonNode responseNode=objectMapper.readTree(response.getStream());
  assertNotNull(responseNode);
  assertEquals("binaryVariable",responseNode.get("name").asText());
  assertTrue(responseNode.get("value").isNull());
  assertEquals("local",responseNode.get("scope").asText());
  assertEquals("binary",responseNode.get("type").asText());
  assertNotNull(responseNode.get("valueUrl").isNull());
  assertTrue(responseNode.get("valueUrl").asText().endsWith(RestUrls.createRelativeResourceUrl(RestUrls.URL_EXECUTION_VARIABLE_DATA,childExecution.getId(),"binaryVariable")));
  Object variableValue=runtimeService.getVariableLocal(childExecution.getId(),"binaryVariable");
  assertNotNull(variableValue);
  assertTrue(variableValue instanceof byte[]);
  assertEquals("This is binary content",new String((byte[])variableValue));
  additionalFields.put("scope","global");
  binaryContent=new ByteArrayInputStream("This is binary content global".getBytes());
  uploadRepresentation=new HttpMultipartRepresentation("value",binaryContent,additionalFields);
  response=client.put(uploadRepresentation);
  assertEquals(Status.SUCCESS_OK,client.getResponse().getStatus());
  responseNode=objectMapper.readTree(response.getStream());
  assertNotNull(responseNode);
  assertEquals("binaryVariable",responseNode.get("name").asText());
  assertTrue(responseNode.get("value").isNull());
  assertEquals("global",responseNode.get("scope").asText());
  assertEquals("binary",responseNode.get("type").asText());
  assertNotNull(responseNode.get("valueUrl").isNull());
  assertTrue(responseNode.get("valueUrl").asText().endsWith(RestUrls.createRelativeResourceUrl(RestUrls.URL_EXECUTION_VARIABLE_DATA,childExecution.getId(),"binaryVariable")));
  variableValue=runtimeService.getVariableLocal(processInstance.getId(),"binaryVariable");
  assertNotNull(variableValue);
  assertTrue(variableValue instanceof byte[]);
  assertEquals("This is binary content global",new String((byte[])variableValue));
  variableValue=runtimeService.getVariableLocal(childExecution.getId(),"binaryVariable");
  assertNotNull(variableValue);
  assertTrue(variableValue instanceof byte[]);
  assertEquals("This is binary content",new String((byte[])variableValue));
  client.release();
}
