{
  Map<String,Long> tableCounts=processEngine.getManagementService().getTableCount();
  StringBuilder outputMessage=new StringBuilder();
  for (  String tableName : tableCounts.keySet()) {
    if (!TABLENAMES_EXCLUDED_FROM_DB_CLEAN_CHECK.contains(tableName)) {
      Long count=tableCounts.get(tableName);
      if (count != 0L) {
        outputMessage.append("  " + tableName + ": "+ count+ " record(s) ");
      }
    }
  }
  if (outputMessage.length() > 0) {
    outputMessage.insert(0,"DB NOT CLEAN: \n");
    log.severe(EMPTY_LINE);
    log.severe(outputMessage.toString());
    ((ProcessEngineImpl)processEngine).getProcessEngineConfiguration().getDbSqlSessionFactory();
    Assert.fail(outputMessage.toString());
  }
}
