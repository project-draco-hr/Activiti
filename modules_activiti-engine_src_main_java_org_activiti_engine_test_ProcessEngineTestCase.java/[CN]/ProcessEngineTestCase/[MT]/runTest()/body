{
  LogUtil.resetThreadIndents();
  ThreadLogMode oldThreadRenderingMode=LogUtil.setThreadLogMode(threadRenderingMode);
  if (processEngine == null) {
    processEngine=processEngines.get(configurationResource);
    if (processEngine == null) {
      log.fine("==== BUILDING PROCESS ENGINE ========================================================================");
      processEngine=new ProcessEngineBuilder().configureFromPropertiesResource(configurationResource).buildProcessEngine();
      log.fine("==== PROCESS ENGINE CREATED =========================================================================");
      processEngines.put(configurationResource,processEngine);
    }
    initializeServices();
  }
  log.fine(EMPTY_LINE);
  log.fine("#### START " + ClassNameUtil.getClassNameWithoutPackage(this) + "."+ getName()+ " ###########################################################");
  try {
    processDeploymentAnnotation();
    super.runTest();
  }
 catch (  AssertionFailedError e) {
    log.severe(EMPTY_LINE);
    log.log(Level.SEVERE,"ASSERTION FAILED: " + e,e);
    throw e;
  }
catch (  Throwable e) {
    log.severe(EMPTY_LINE);
    log.log(Level.SEVERE,"EXCEPTION: " + e,e);
    throw e;
  }
 finally {
    for (    String deploymentId : deploymentsToDeleteAfterTestMethod) {
      repositoryService.deleteDeployment(deploymentId);
    }
    assertAndEnsureCleanDb();
    ClockUtil.reset();
    log.fine("#### END " + ClassNameUtil.getClassNameWithoutPackage(this) + "."+ getName()+ " #############################################################");
    LogUtil.setThreadLogMode(oldThreadRenderingMode);
  }
}
