{
  if (authenticate() == false)   return null;
  String taskId=(String)getRequest().getAttributes().get("taskId");
  if (taskId == null || taskId.length() == 0) {
    throw new ActivitiIllegalArgumentException("No taskId provided");
  }
  try {
    String taskParams=entity.getText();
    JsonNode taskJSON=new ObjectMapper().readTree(taskParams);
    String name=null;
    if (taskJSON.path("name") != null && taskJSON.path("name").textValue() != null) {
      name=taskJSON.path("name").textValue();
    }
    String description=null;
    if (taskJSON.path("description") != null && taskJSON.path("description").textValue() != null) {
      description=taskJSON.path("description").textValue();
    }
    String url=null;
    if (taskJSON.path("url") != null && taskJSON.path("url").textValue() != null) {
      url=taskJSON.path("url").textValue();
    }
    Attachment attachment=ActivitiUtil.getTaskService().createAttachment("url",taskId,null,name,description,url);
    return new AttachmentResponse(attachment);
  }
 catch (  Exception e) {
    if (e instanceof ActivitiException) {
      throw (ActivitiException)e;
    }
    throw new ActivitiException("Unable to add new attachment to task " + taskId);
  }
}
