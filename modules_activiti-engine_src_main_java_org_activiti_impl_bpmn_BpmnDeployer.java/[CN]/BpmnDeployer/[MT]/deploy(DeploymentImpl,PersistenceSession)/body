{
  Map<String,ByteArrayImpl> resources=deployment.getResources();
  for (  String resourceName : resources.keySet()) {
    LOG.info("Processing resource " + resourceName);
    if (resourceName.endsWith(BPMN_RESOURCE_SUFFIX)) {
      ByteArrayImpl resource=resources.get(resourceName);
      byte[] bytes=resource.getBytes();
      ByteArrayInputStream inputStream=new ByteArrayInputStream(bytes);
      BpmnParse bpmnParse=new BpmnParser(expressionManager,scriptingEngines,businessCalendarManager).createParse().processDefinitionClass(ProcessDefinitionDbImpl.class).sourceInputStream(inputStream).execute();
      for (      ProcessDefinitionImpl processDefinition : bpmnParse.getProcessDefinitions()) {
        processDefinition.setDeployment(deployment);
        processDefinition.setNew(deployment.isNew());
        persistenceSession.insertProcessDefinition(processDefinition);
      }
    }
  }
}
