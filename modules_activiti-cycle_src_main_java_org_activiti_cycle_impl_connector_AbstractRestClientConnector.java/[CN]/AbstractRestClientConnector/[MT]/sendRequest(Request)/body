{
  injectCustomSecurityMechanism(request);
  if (log.isLoggable(Level.FINE)) {
    RestClientLogHelper.logHttpRequest(log,Level.FINE,request);
  }
  Client client=initClient();
  Response response=client.handle(request);
  if (log.isLoggable(Level.FINE)) {
    RestClientLogHelper.logHttpResponse(log,Level.FINE,response);
  }
  if (response.getStatus().isSuccess()) {
    return response;
  }
 else   if (response.getStatus().equals(Status.CLIENT_ERROR_UNAUTHORIZED)) {
    Request retryRequest=createChallengeResponse(response);
    return sendRequest(retryRequest);
  }
  throw new RepositoryException("Encountered error while retrieving http response (HttpStatus: " + response.getStatus() + ", Body: "+ response.getEntity().getText()+ ")");
}
