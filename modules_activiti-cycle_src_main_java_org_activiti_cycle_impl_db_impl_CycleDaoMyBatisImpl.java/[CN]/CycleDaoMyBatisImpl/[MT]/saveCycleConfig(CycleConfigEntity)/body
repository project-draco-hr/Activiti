{
  SqlSession session=openSession();
  try {
    if (null != entity.getId()) {
      session.update("updateCycleConfigById",entity);
    }
 else {
      CycleConfigEntity existingEntity=selectCycleConfigByGroupAndKey(entity.getGroupName(),entity.getKey());
      if (existingEntity != null) {
        throw new RuntimeException("An entity with key '" + entity.getKey() + "' and group '"+ entity.getGroupName()+ "' already exists. ");
      }
      entity.setId(UUID.randomUUID().toString());
      session.insert("insertCycleConfig",entity);
    }
    session.commit();
  }
 catch (  Exception e) {
    log.log(Level.WARNING,"Could not update " + entity,e);
    session.rollback();
    throw new RuntimeException(e);
  }
 finally {
    session.close();
  }
}
