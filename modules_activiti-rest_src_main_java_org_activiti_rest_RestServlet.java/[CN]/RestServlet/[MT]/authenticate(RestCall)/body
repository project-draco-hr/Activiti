{
  String headerText=call.getHttpServletRequest().getHeader("Auth");
  if (headerText == null) {
    headerText=call.getHttpServletRequest().getHeader("Authorization");
  }
  if (headerText != null && headerText.startsWith("Basic ")) {
    String encodedHeader=headerText.substring(6);
    String decodedHeader=new String(Base64.decodeBase64(encodedHeader));
    int colonIndex=decodedHeader.indexOf(':');
    if (colonIndex != -1) {
      String username=decodedHeader.substring(0,colonIndex);
      String password=decodedHeader.substring(colonIndex + 1);
      User user=Persistence.getUsers().findUser(username);
      boolean authenticationOk=password.equals(user.getPassword());
      if (authenticationOk) {
        return username;
      }
    }
  }
  call.getHttpServletResponse().setHeader("WWW-Authenticate","Basic realm=\"Activiti\"");
  throw new RestException(HttpServletResponse.SC_UNAUTHORIZED,"basic authentication required");
}
