{
  List<RestVariable> result=new ArrayList<RestVariable>();
  Map<String,RestVariable> variableMap=new HashMap<String,RestVariable>();
  Task task=getTaskFromRequest(taskId);
  String serverRootUrl=request.getRequestURL().toString();
  serverRootUrl=serverRootUrl.substring(0,serverRootUrl.indexOf("/runtime/tasks/"));
  RestVariableScope variableScope=RestVariable.getScopeFromString(scope);
  if (variableScope == null) {
    addLocalVariables(task,variableMap,serverRootUrl);
    addGlobalVariables(task,variableMap,serverRootUrl);
  }
 else   if (variableScope == RestVariableScope.GLOBAL) {
    addGlobalVariables(task,variableMap,serverRootUrl);
  }
 else   if (variableScope == RestVariableScope.LOCAL) {
    addLocalVariables(task,variableMap,serverRootUrl);
  }
  result.addAll(variableMap.values());
  return result;
}
