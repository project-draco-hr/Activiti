{
  String procDefId=repositoryService.createProcessDefinitionQuery().singleResult().getId();
  StartFormData startForm=formService.getStartFormData(procDefId);
  assertNotNull(startForm);
  assertEquals(deploymentIdFromDeploymentAnnotation,startForm.getDeploymentId());
  assertEquals("org/activiti/engine/test/api/form/start.form",startForm.getFormKey());
  assertEquals(new ArrayList<FormProperty>(),startForm.getFormProperties());
  assertEquals(procDefId,startForm.getProcessDefinition().getId());
  Object renderedStartForm=formService.getRenderedStartForm(procDefId);
  assertEquals("start form content",renderedStartForm);
  Map<String,String> properties=new HashMap<String,String>();
  properties.put("room","5b");
  properties.put("speaker","Mike");
  String processInstanceId=formService.submitStartFormData(procDefId,properties).getId();
  Map<String,Object> expectedVariables=new HashMap<String,Object>();
  expectedVariables.put("room","5b");
  expectedVariables.put("speaker","Mike");
  Map<String,Object> variables=runtimeService.getVariables(processInstanceId);
  assertEquals(expectedVariables,variables);
  Task task=taskService.createTaskQuery().singleResult();
  String taskId=task.getId();
  TaskFormData taskForm=formService.getTaskFormData(taskId);
  assertEquals(deploymentIdFromDeploymentAnnotation,taskForm.getDeploymentId());
  assertEquals("org/activiti/engine/test/api/form/task.form",taskForm.getFormKey());
  assertEquals(new ArrayList<FormProperty>(),taskForm.getFormProperties());
  assertEquals(taskId,taskForm.getTask().getId());
  assertEquals("Mike is speaking in room 5b",formService.getRenderedTaskForm(taskId));
  properties=new HashMap<String,String>();
  properties.put("room","3f");
  formService.submitTaskFormData(taskId,properties);
  expectedVariables=new HashMap<String,Object>();
  expectedVariables.put("room","3f");
  expectedVariables.put("speaker","Mike");
  variables=runtimeService.getVariables(processInstanceId);
  assertEquals(expectedVariables,variables);
}
