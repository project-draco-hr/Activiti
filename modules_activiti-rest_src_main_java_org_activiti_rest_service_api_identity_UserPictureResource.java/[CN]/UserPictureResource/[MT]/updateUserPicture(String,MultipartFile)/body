{
  User user=getUserFromRequest(userId);
  try {
    String mimeType=file.getContentType();
    int size=((Long)file.getSize()).intValue();
    ByteArrayOutputStream bytesOutput=new ByteArrayOutputStream(size);
    IOUtils.copy(file.getInputStream(),bytesOutput);
    Picture newPicture=new Picture(bytesOutput.toByteArray(),mimeType);
    identityService.setUserPicture(user.getId(),newPicture);
  }
 catch (  Exception e) {
    throw new ActivitiException("Error while reading uploaded file: " + e.getMessage(),e);
  }
}
