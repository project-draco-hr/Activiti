{
  if (authenticate() == false)   return null;
  if (actionRequest == null) {
    throw new ActivitiIllegalArgumentException("No action found in request body.");
  }
  ProcessDefinition processDefinition=getProcessDefinitionFromRequest();
  if (actionRequest.getCategory() != null) {
    ActivitiUtil.getRepositoryService().setProcessDefinitionCategory(processDefinition.getId(),actionRequest.getCategory());
    ProcessDefinitionResponse response=getApplication(ActivitiRestServicesApplication.class).getRestResponseFactory().createProcessDefinitionResponse(this,processDefinition);
    response.setCategory(actionRequest.getCategory());
    return response;
  }
 else {
    if (actionRequest.getAction() != null) {
      if (ProcessDefinitionActionRequest.ACTION_SUSPEND.equals(actionRequest.getAction())) {
        return suspendProcessDefinition(processDefinition,actionRequest.isIncludeProcessInstances(),actionRequest.getDate());
      }
 else       if (ProcessDefinitionActionRequest.ACTION_ACTIVATE.equals(actionRequest.getAction())) {
        return activateProcessDefinition(processDefinition,actionRequest.isIncludeProcessInstances(),actionRequest.getDate());
      }
    }
    throw new ActivitiIllegalArgumentException("Invalid action: '" + actionRequest.getAction() + "'.");
  }
}
