{
  DataSource ds=null;
  if (activitiConfigurer != null) {
    DataSource dataSource=activitiConfigurer.dataSource();
    if (null != dataSource) {
      ds=dataSource;
    }
  }
  String defaultName="activitiDataSource";
  if (dataSourceMap.size() > 0) {
    for (    DataSource d : dataSourceMap.values()) {
      ds=d;
    }
  }
  if (dataSourceMap.containsKey(defaultName)) {
    ds=dataSourceMap.get(defaultName);
  }
  Assert.notNull(ds,"there must be at least one valid DataSource");
  return ds;
}
