{
  ConfigurationContainer configurationContainer=new ConfigurationContainer("bernd");
  RepositoryConnectorConfiguration configuration=new DemoConnectorConfiguration("demo");
  configurationContainer.addRepositoryConnectorConfiguration(configuration);
  CycleService cycleService=new CycleServiceImpl(configurationContainer.getConnectorList());
  cycleService.login("bernd","bernd");
  List<RepositoryNode> childNodes=cycleService.getChildren("demo","/").asList();
  assertEquals(2,childNodes.size());
  assertTrue(childNodes.get(0) instanceof RepositoryFolder);
  RepositoryFolder folder1=(RepositoryFolder)childNodes.get(0);
  assertEquals("/minutes",folder1.getCurrentPath());
  assertTrue(childNodes.get(1) instanceof RepositoryFolder);
  RepositoryFolder folder2=(RepositoryFolder)childNodes.get(1);
  assertEquals("/BPMN",folder2.getCurrentPath());
  childNodes=cycleService.getChildren("demo",folder1.getCurrentPath()).asList();
  assertEquals(2,childNodes.size());
  RepositoryArtifact file1=(RepositoryArtifact)childNodes.get(0);
  assertEquals("/minutes/20100701-KickOffMeeting.txt",file1.getCurrentPath());
  RepositoryArtifact file2=(RepositoryArtifact)childNodes.get(1);
  assertEquals("/minutes/InitialMindmap.mm",file2.getCurrentPath());
  childNodes=cycleService.getChildren("demo",folder2.getCurrentPath()).asList();
  assertEquals(1,childNodes.size());
  RepositoryFolder folder3=(RepositoryFolder)childNodes.get(0);
  assertEquals("/BPMN/Level3",folder3.getCurrentPath());
  childNodes=cycleService.getChildren("demo",folder3.getCurrentPath()).asList();
  assertEquals(1,childNodes.size());
  RepositoryArtifact file3=(RepositoryArtifact)childNodes.get(0);
  assertEquals("/BPMN/Level3/InitialBpmnModel",file3.getCurrentPath());
  assertEquals("InitialBpmnModel",file3.getMetadata().getName());
  assertEquals("/BPMN/Level3",file3.getMetadata().setParentFolderId());
  Collection<ContentRepresentation> contentRepresentations=file3.getArtifactType().getContentRepresentations();
  for (  ContentRepresentation contentRepresentation : contentRepresentations) {
    Content content=cycleService.getContent("demo",file3.getCurrentPath(),contentRepresentation.getId());
    assertNotNull(content);
    assertNotNull(content.asByteArray());
  }
  assertEquals(6,DemoConnector.nodes.size());
  Map<String,Object> parameters=new HashMap<String,Object>();
  parameters.put("targetName","xxx.txt");
  parameters.put("copyCount",2);
  parameters.put("targetConnectorId","demo");
  parameters.put("targetFolderId","/minutes");
  cycleService.executeParameterizedAction("demo",file1.getCurrentPath(),CopyArtifactAction.class.getName(),parameters);
  List<RepositoryNode> nodes=DemoConnector.nodes;
  assertEquals(8,DemoConnector.nodes.size());
  childNodes=cycleService.getChildren("demo",folder1.getCurrentPath()).asList();
  assertEquals(4,childNodes.size());
  assertEquals("/minutes/20100701-KickOffMeeting.txt",childNodes.get(0).getCurrentPath());
  assertEquals("/minutes/InitialMindmap.mm",childNodes.get(1).getCurrentPath());
  assertEquals("/minutes/xxx.txt0",childNodes.get(2).getCurrentPath());
  assertEquals("xxx.txt0",childNodes.get(2).getMetadata().getName());
  assertEquals("/minutes/xxx.txt1",childNodes.get(3).getCurrentPath());
  assertEquals("xxx.txt1",childNodes.get(3).getMetadata().getName());
}
