{
  ConfigurationContainer userConfiguration=new ConfigurationContainer("bernd");
  userConfiguration.addRepositoryConnectorConfiguration(new DemoConnectorConfiguration("demo"));
  RepositoryConnector conn=new CustomizedViewConfiguration("http://localhost:8080/activiti-cycle/",userConfiguration).createConnector();
  List<RepositoryNode> childNodes=conn.getChildren("/").asList();
  assertEquals(1,childNodes.size());
  assertEquals("demo",childNodes.get(0).getId());
  childNodes=conn.getChildren("demo").asList();
  assertEquals(2,childNodes.size());
  assertTrue(childNodes.get(0) instanceof RepositoryFolder);
  RepositoryFolder folder1=(RepositoryFolder)childNodes.get(0);
  assertEquals("/demo/minutes",folder1.getId());
  assertTrue(childNodes.get(1) instanceof RepositoryFolder);
  RepositoryFolder folder2=(RepositoryFolder)childNodes.get(1);
  assertEquals("/demo/BPMN",folder2.getId());
  childNodes=conn.getChildren(folder1.getId()).asList();
  assertEquals(2,childNodes.size());
  RepositoryArtifact file1=(RepositoryArtifact)childNodes.get(0);
  assertEquals("/demo/minutes/20100701-KickOffMeeting.txt",file1.getId());
  RepositoryArtifact file2=(RepositoryArtifact)childNodes.get(1);
  assertEquals("/demo/minutes/InitialMindmap.mm",file2.getId());
  childNodes=conn.getChildren(folder2.getId()).asList();
  assertEquals(1,childNodes.size());
  RepositoryFolder folder3=(RepositoryFolder)childNodes.get(0);
  assertEquals("/demo/BPMN/Level3",folder3.getId());
  childNodes=conn.getChildren(folder3.getId()).asList();
  assertEquals(1,childNodes.size());
  RepositoryArtifact file3=(RepositoryArtifact)childNodes.get(0);
  assertEquals("/demo/BPMN/Level3/InitialBpmnModel",file3.getId());
  assertEquals("InitialBpmnModel",file3.getMetadata().getName());
  assertEquals("/BPMN/Level3",file3.getMetadata().setParentFolderId());
  Collection<ContentRepresentation> contentRepresentations=file3.getArtifactType().getContentRepresentations();
  for (  ContentRepresentation contentRepresentation : contentRepresentations) {
    Content content=conn.getContent(file3.getId(),contentRepresentation.getId());
    assertNotNull(content);
    assertNotNull(content.asByteArray());
  }
  assertEquals(6,DemoConnector.nodes.size());
  Map<String,Object> parameters=new HashMap<String,Object>();
  parameters.put("targetName","xxx.txt");
  parameters.put("copyCount",2);
  conn.executeParameterizedAction(file1.getId(),CopyArtifactAction.class.getName(),parameters);
  List<RepositoryNode> nodes=DemoConnector.nodes;
  assertEquals(8,DemoConnector.nodes.size());
  childNodes=conn.getChildren(folder1.getId()).asList();
  assertEquals(4,childNodes.size());
  assertEquals("/demo/minutes/20100701-KickOffMeeting.txt",childNodes.get(0).getId());
  assertEquals("/demo/minutes/InitialMindmap.mm",childNodes.get(1).getId());
  assertEquals("/demo/minutes/xxx.txt0",childNodes.get(2).getId());
  assertEquals("xxx.txt0",childNodes.get(2).getMetadata().getName());
  assertEquals("/demo/minutes/xxx.txt1",childNodes.get(3).getId());
  assertEquals("xxx.txt1",childNodes.get(3).getMetadata().getName());
}
