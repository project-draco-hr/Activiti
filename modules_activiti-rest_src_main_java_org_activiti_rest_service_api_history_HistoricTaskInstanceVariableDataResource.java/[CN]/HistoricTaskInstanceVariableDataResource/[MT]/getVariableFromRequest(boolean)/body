{
  String taskId=getAttribute("taskId");
  if (taskId == null) {
    throw new ActivitiIllegalArgumentException("The taskId cannot be null");
  }
  String variableName=getAttribute("variableName");
  if (variableName == null) {
    throw new ActivitiIllegalArgumentException("The variableName cannot be null");
  }
  RestVariableScope variableScope=RestVariable.getScopeFromString(getQueryParameter("scope",getQuery()));
  HistoricTaskInstanceQuery taskQuery=ActivitiUtil.getHistoryService().createHistoricTaskInstanceQuery().taskId(taskId);
  if (variableScope != null) {
    if (variableScope == RestVariableScope.GLOBAL) {
      taskQuery.includeProcessVariables();
    }
 else {
      taskQuery.includeTaskLocalVariables();
    }
  }
 else {
    taskQuery.includeTaskLocalVariables().includeProcessVariables();
  }
  HistoricTaskInstance taskObject=taskQuery.singleResult();
  if (taskObject == null) {
    throw new ActivitiObjectNotFoundException("Historic task instance '" + taskId + "' couldn't be found.",HistoricTaskInstanceEntity.class);
  }
  Object value=null;
  if (variableScope != null) {
    if (variableScope == RestVariableScope.GLOBAL) {
      value=taskObject.getProcessVariables().get(variableName);
    }
 else {
      value=taskObject.getTaskLocalVariables().get(variableName);
    }
  }
 else {
    if (taskObject.getTaskLocalVariables().containsKey(variableName)) {
      value=taskObject.getTaskLocalVariables().get(variableName);
    }
 else {
      value=taskObject.getProcessVariables().get(variableName);
    }
  }
  if (value == null) {
    throw new ActivitiObjectNotFoundException("Historic task instance '" + taskId + "' variable value for "+ variableName+ " couldn't be found.",VariableInstanceEntity.class);
  }
 else {
    RestResponseFactory responseFactory=getApplication(ActivitiRestServicesApplication.class).getRestResponseFactory();
    return responseFactory.createRestVariable(this,variableName,value,null,taskId,RestResponseFactory.VARIABLE_HISTORY_TASK,includeBinary);
  }
}
