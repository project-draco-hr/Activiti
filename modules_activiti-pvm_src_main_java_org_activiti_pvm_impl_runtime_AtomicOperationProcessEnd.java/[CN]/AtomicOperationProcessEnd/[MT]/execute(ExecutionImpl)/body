{
  ProcessDefinitionImpl processDefinition=execution.getProcessDefinition();
  List<EventListener> eventListeners=processDefinition.getEventListeners(EventListener.EVENTNAME_END);
  int eventListenerIndex=execution.getEventListenerIndex();
  if (eventListeners.size() > eventListenerIndex) {
    execution.setEventName(EventListener.EVENTNAME_END);
    execution.setEventSource(processDefinition);
    EventListener listener=eventListeners.get(eventListenerIndex);
    listener.notify(execution);
    execution.setEventListenerIndex(eventListenerIndex + 1);
    execution.performOperation(this);
  }
 else {
    execution.setEventListenerIndex(0);
    execution.setEventName(null);
    execution.setEventSource(null);
    execution.destroy();
    execution.remove();
    ExecutionImpl superExecution=execution.getSuperExecution();
    if (superExecution != null) {
      superExecution.setSubProcessInstance(null);
      SubProcessActivityBehavior subProcessActivityBehavior=(SubProcessActivityBehavior)superExecution.getActivity().getActivityBehavior();
      try {
        subProcessActivityBehavior.completed(superExecution);
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
  }
}
