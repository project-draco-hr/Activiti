{
  while (isActive) {
    List<MailScanCmd> round=new ArrayList<MailScanCmd>(scanCommands.values());
    for (    MailScanCmd mailScanCmd : round) {
      try {
        commandExecutor.execute(mailScanCmd);
      }
 catch (      Exception e) {
        log.log(Level.SEVERE,"couldn't check todo mail for " + mailScanCmd.getUserId() + ": "+ e.getMessage(),e);
      }
    }
    if (scanCommands.isEmpty()) {
      try {
        Thread.sleep(5000);
      }
 catch (      InterruptedException e) {
        log.fine("sleep got interrupted");
      }
    }
  }
}
