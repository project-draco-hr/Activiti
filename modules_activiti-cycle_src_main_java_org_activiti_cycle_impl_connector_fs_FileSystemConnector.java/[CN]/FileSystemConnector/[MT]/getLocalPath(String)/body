{
  String basePath=getBasePath();
  if ("".equals(basePath)) {
    return path;
  }
  String canonicalBasePath=null;
  String canonicalPath=null;
  try {
    canonicalBasePath=new File(basePath).getCanonicalPath();
    canonicalPath=new File(path).getCanonicalPath();
  }
 catch (  IOException e) {
    throw new RepositoryException("Unable to determine local path: " + e.getMessage(),e);
  }
  if (!canonicalPath.startsWith(canonicalBasePath)) {
    throw new RepositoryException("Unable to determine local path (path: '" + path + "' canonicalPath: '"+ canonicalPath+ "', base path: '"+ basePath+ "', canonicalBasePath: '"+ canonicalBasePath+ "'): ");
  }
  path=canonicalPath.replace(canonicalBasePath,"");
  path=normalizePath(path);
  return path;
}
