{
  ProcessInstance processInstance=runtimeService.createProcessInstanceQuery().includeProcessVariables().variableValueEquals("anothertest",123).singleResult();
  Map<String,Object> variableMap=processInstance.getProcessVariables();
  assertEquals(1,variableMap.size());
  assertEquals(123,variableMap.get("anothertest"));
  List<ProcessInstance> instanceList=runtimeService.createProcessInstanceQuery().includeProcessVariables().list();
  assertEquals(5,instanceList.size());
  instanceList=runtimeService.createProcessInstanceQuery().includeProcessVariables().processDefinitionKey(PROCESS_DEFINITION_KEY).list();
  assertEquals(4,instanceList.size());
  processInstance=instanceList.get(0);
  variableMap=processInstance.getProcessVariables();
  assertEquals(2,variableMap.size());
  assertEquals("test",variableMap.get("test"));
  assertEquals("test2",variableMap.get("test2"));
  processInstance=runtimeService.createProcessInstanceQuery().includeProcessVariables().processDefinitionKey(PROCESS_DEFINITION_KEY_2).singleResult();
  variableMap=processInstance.getProcessVariables();
  assertEquals(1,variableMap.size());
  assertEquals(123,variableMap.get("anothertest"));
}
