{
  BusinessProcessAssociationManager associationManager=null;
  try {
    associationManager=ProgrammaticBeanLookup.lookup(BusinessProcessAssociationManager.class);
  }
 catch (  Exception e) {
    logger.finest("Not flushing the beanStore, could not lookup " + BusinessProcessAssociationManager.class.getName());
    return;
  }
  if (associationManager.getProcessInstanceId() != null) {
    ExecutionEntity processInstance=Context.getCommandContext().getRuntimeSession().findExecutionById(associationManager.getProcessInstanceId());
    if (processInstance != null && !processInstance.isEnded()) {
      CachingBeanStore beanStore=associationManager.getBeanStore();
      logFlushSummary(beanStore);
      processInstance.setVariables(beanStore.getAll());
      beanStore.clear();
    }
  }
}
