{
  BusinessProcessAssociationManager associationManager=null;
  String processInstanceId=null;
  try {
    associationManager=ProgrammaticBeanLookup.lookup(BusinessProcessAssociationManager.class);
    processInstanceId=associationManager.getProcessInstanceId();
  }
 catch (  Exception e) {
    logger.finest("Not flushing the beanStore, could not lookup " + BusinessProcessAssociationManager.class.getName());
    return;
  }
  if (processInstanceId != null) {
    ExecutionEntity processInstance=Context.getCommandContext().getExecutionManager().findExecutionById(processInstanceId);
    if (processInstance != null && !processInstance.isEnded()) {
      CachingBeanStore beanStore=associationManager.getBeanStore();
      logFlushSummary(beanStore);
      processInstance.setVariables(beanStore.getAll());
      beanStore.clear();
    }
  }
}
