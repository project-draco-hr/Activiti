{
  ProcessEngine processEngine=buildProcessEngine("activiti.properties");
  processEngine.getProcessService().createDeployment().addClasspathResource("org/activiti/test/service/RebootProcessEngineTestProcess.bpmn20.xml").deploy();
  List<ProcessDefinition> processDefinitions=processEngine.getProcessService().findProcessDefinitions();
  assertEquals(1,processDefinitions.size());
  ProcessInstance processInstance=processEngine.getProcessService().startProcessInstanceById(processDefinitions.get(0).getId());
  assertNotNull(processInstance);
  processEngine.close();
  assertNotNull(processEngine.getProcessService());
  processEngine=buildProcessEngine("activiti.reboot.properties");
  processInstance=processEngine.getProcessService().startProcessInstanceById(processDefinitions.get(0).getId());
  assertNotNull(processInstance);
  ((ProcessEngineImpl)processEngine).getPersistenceSessionFactory().dbSchemaDrop();
}
