{
  PvmActivity errorEventHandler=null;
  PvmScope scope=execution.getActivity();
  while (errorEventHandler == null && scope != null) {
    for (    PvmActivity activity : scope.getActivities()) {
      if (((ActivityImpl)activity).getActivityBehavior() instanceof SubProcessActivityBehavior && Boolean.TRUE.equals(activity.getProperty("triggeredByEvent"))) {
        List<? extends PvmActivity> activities=activity.getActivities();
        for (        PvmActivity eventSubProcessActivity : activities) {
          if (((ActivityImpl)eventSubProcessActivity).getActivityBehavior() instanceof EventSubProcessStartEventActivityBehavior && "errorStartEvent".equals(eventSubProcessActivity.getProperty("type")) && errorCode.equals(eventSubProcessActivity.getProperty("errorCode"))) {
            errorEventHandler=activity;
            break;
          }
        }
        if (errorEventHandler != null) {
          break;
        }
      }
    }
    if (errorEventHandler == null) {
      for (      PvmActivity activity : scope.getActivities()) {
        if (((ActivityImpl)activity).getActivityBehavior() instanceof SubProcessActivityBehavior && Boolean.TRUE.equals(activity.getProperty("triggeredByEvent"))) {
          List<? extends PvmActivity> activities=activity.getActivities();
          for (          PvmActivity eventSubProcessActivity : activities) {
            if (((ActivityImpl)eventSubProcessActivity).getActivityBehavior() instanceof EventSubProcessStartEventActivityBehavior && "errorStartEvent".equals(eventSubProcessActivity.getProperty("type")) && eventSubProcessActivity.getProperty("errorCode") == null) {
              errorEventHandler=activity;
              break;
            }
          }
          if (errorEventHandler != null) {
            break;
          }
        }
      }
    }
    if (errorEventHandler == null) {
      for (      PvmActivity activity : scope.getActivities()) {
        if (((ActivityImpl)activity).getActivityBehavior() instanceof BoundaryEventActivityBehavior && "boundaryError".equals(activity.getProperty("type")) && errorCode.equals(activity.getProperty("errorCode"))) {
          errorEventHandler=activity;
          break;
        }
      }
    }
    if (errorEventHandler == null) {
      for (      PvmActivity activity : scope.getActivities()) {
        if (((ActivityImpl)activity).getActivityBehavior() instanceof BoundaryEventActivityBehavior && "boundaryError".equals(activity.getProperty("type")) && activity.getProperty("errorCode") == null) {
          errorEventHandler=activity;
          break;
        }
      }
    }
    if (errorEventHandler == null) {
      if (scope instanceof PvmActivity) {
        scope=((PvmActivity)scope).getParent();
      }
 else {
        scope=null;
      }
    }
  }
  return errorEventHandler;
}
