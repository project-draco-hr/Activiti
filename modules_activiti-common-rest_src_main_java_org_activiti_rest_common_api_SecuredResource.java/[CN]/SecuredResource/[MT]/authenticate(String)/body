{
  loggedInUser=((ActivitiRestApplication)getApplication()).authenticate(getRequest(),getResponse());
  if (loggedInUser == null) {
    setStatus(getAuthenticationFailureStatus(),"Authentication is required");
    return false;
  }
 else   if (group == null) {
    ActivitiUtil.getIdentityService().setAuthenticatedUserId(loggedInUser);
    return true;
  }
 else {
    boolean allowed=false;
    List<Group> groupList=ActivitiUtil.getIdentityService().createGroupQuery().groupMember(loggedInUser).list();
    if (groupList != null) {
      for (      Group groupObject : groupList) {
        if (groupObject.getId().equals(group)) {
          allowed=true;
          ActivitiUtil.getIdentityService().setAuthenticatedUserId(loggedInUser);
          break;
        }
      }
    }
    if (allowed == false) {
      setStatus(getAuthenticationFailureStatus(),"User is not part of the group " + group);
    }
    return allowed;
  }
}
