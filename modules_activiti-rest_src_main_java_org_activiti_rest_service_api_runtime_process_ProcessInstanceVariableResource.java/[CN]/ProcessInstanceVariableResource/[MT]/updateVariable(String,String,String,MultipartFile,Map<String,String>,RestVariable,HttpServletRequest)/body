{
  Execution execution=getProcessInstanceFromRequest(processInstanceId);
  String serverRootUrl=request.getRequestURL().toString();
  serverRootUrl=serverRootUrl.substring(0,serverRootUrl.indexOf("/runtime/process-instances/"));
  RestVariable result=null;
  if (file != null) {
    result=setBinaryVariable(file,allRequestParams,execution,false,serverRootUrl);
    if (!result.getName().equals(variableName)) {
      throw new ActivitiIllegalArgumentException("Variable name in the body should be equal to the name used in the requested URL.");
    }
  }
 else {
    if (restVariable == null) {
      throw new ActivitiException("Invalid body was supplied");
    }
    if (!restVariable.getName().equals(variableName)) {
      throw new ActivitiIllegalArgumentException("Variable name in the body should be equal to the name used in the requested URL.");
    }
    result=setSimpleVariable(restVariable,execution,false,serverRootUrl);
  }
  return result;
}
