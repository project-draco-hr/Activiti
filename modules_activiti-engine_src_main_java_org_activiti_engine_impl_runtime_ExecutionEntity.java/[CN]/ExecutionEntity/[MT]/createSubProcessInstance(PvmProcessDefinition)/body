{
  PvmProcessInstance subProcessInstance=super.createSubProcessInstance(processDefinition);
  CommandContext commandContext=CommandContext.getCurrent();
  int historyLevel=commandContext.getProcessEngineConfiguration().getHistoryLevel();
  if (historyLevel >= ProcessEngineConfigurationImpl.HISTORYLEVEL_ACTIVITY) {
    DbSqlSession dbSqlSession=commandContext.getSession(DbSqlSession.class);
    HistoricProcessInstanceEntity historicProcessInstance=new HistoricProcessInstanceEntity((ExecutionEntity)subProcessInstance);
    dbSqlSession.insert(historicProcessInstance);
  }
  return subProcessInstance;
}
