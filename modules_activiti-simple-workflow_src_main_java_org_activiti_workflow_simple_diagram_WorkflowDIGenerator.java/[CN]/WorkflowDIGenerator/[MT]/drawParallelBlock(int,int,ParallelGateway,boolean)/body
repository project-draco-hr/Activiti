{
  int originalCurrentWidth=currentWidth;
  List<SequenceFlow> sequenceFlows=outgoingSequenceFlowMapping.get(parallelGateway.getId());
  int nrOfTasks=sequenceFlows.size();
  drawParallelGateway(parallelGateway,x,y,GATEWAY_WIDTH,GATEWAY_HEIGHT,generateImage);
  handledElements.add(parallelGateway.getId());
  int centerOfRhombus=x + GATEWAY_WIDTH / 2;
  int maxHeight=(nrOfTasks / 2) * (TASK_HEIGHT + TASK_HEIGHT_SPACING);
  int currentHeight=y - maxHeight;
  for (int i=0; i < nrOfTasks / 2; i++) {
    SequenceFlow sequenceFlow1=sequenceFlows.get(i);
    drawSequenceFlow(sequenceFlow1,generateImage,centerOfRhombus,y,centerOfRhombus,currentHeight,centerOfRhombus + SEQUENCE_FLOW_WIDTH,currentHeight);
    String targetFlowElementId=sequenceFlow1.getTargetRef();
    FlowElement userTask=process.getFlowElement(targetFlowElementId);
    drawTask(userTask,centerOfRhombus + SEQUENCE_FLOW_WIDTH,currentHeight - ((TASK_HEIGHT + TASK_HEIGHT_SPACING) / 2),TASK_WIDTH,TASK_HEIGHT,generateImage);
    handledElements.add(userTask.getId());
    int seqFlowX=centerOfRhombus + SEQUENCE_FLOW_WIDTH + TASK_WIDTH;
    SequenceFlow sequenceFlow2=outgoingSequenceFlowMapping.get(userTask.getId()).get(0);
    drawSequenceFlow(sequenceFlow2,generateImage,seqFlowX,currentHeight,seqFlowX + LONG_SEQUENCE_FLOW_WITHOUT_ARROW_WIDTH,currentHeight,seqFlowX + LONG_SEQUENCE_FLOW_WITHOUT_ARROW_WIDTH,y);
    currentHeight+=TASK_HEIGHT + TASK_HEIGHT_SPACING;
  }
  if (nrOfTasks % 2 != 0) {
    SequenceFlow sequenceFlow1=sequenceFlows.get(nrOfTasks / 2);
    drawSequenceFlow(sequenceFlow1,generateImage,centerOfRhombus + GATEWAY_WIDTH / 2,startY + EVENT_WIDTH / 2,centerOfRhombus + SEQUENCE_FLOW_WIDTH,startY + EVENT_WIDTH / 2);
    String targetFlowElementId=sequenceFlow1.getTargetRef();
    FlowElement userTask=process.getFlowElement(targetFlowElementId);
    drawTask(userTask,centerOfRhombus + SEQUENCE_FLOW_WIDTH,startY - ((TASK_HEIGHT - GATEWAY_HEIGHT)),TASK_WIDTH,TASK_HEIGHT,generateImage);
    handledElements.add(userTask.getId());
    int seqflowX=centerOfRhombus + GATEWAY_WIDTH / 2 + (SEQUENCE_FLOW_WIDTH - GATEWAY_WIDTH / 2) + TASK_WIDTH;
    SequenceFlow sequenceFlow2=outgoingSequenceFlowMapping.get(userTask.getId()).get(0);
    drawSequenceFlow(sequenceFlow2,generateImage,seqflowX,startY + EVENT_WIDTH / 2,seqflowX + LONG_SEQUENCE_FLOW_WIDTH - GATEWAY_WIDTH / 2 - ARROW_WIDTH,startY + EVENT_WIDTH / 2);
  }
  currentHeight=y + GATEWAY_HEIGHT + TASK_HEIGHT+ TASK_HEIGHT_SPACING;
  int startIndex=nrOfTasks % 2 == 0 ? nrOfTasks / 2 : (nrOfTasks / 2) + 1;
  for (int i=startIndex; i < nrOfTasks; i++) {
    SequenceFlow sequenceFlow1=sequenceFlows.get(i);
    drawSequenceFlow(sequenceFlow1,generateImage,centerOfRhombus,y + GATEWAY_HEIGHT,centerOfRhombus,currentHeight,centerOfRhombus + SEQUENCE_FLOW_WIDTH,currentHeight);
    String targetFlowElementId=sequenceFlow1.getTargetRef();
    FlowElement userTask=process.getFlowElement(targetFlowElementId);
    drawTask(userTask,centerOfRhombus + SEQUENCE_FLOW_WIDTH,currentHeight - ((TASK_HEIGHT + TASK_HEIGHT_SPACING) / 2),TASK_WIDTH,TASK_HEIGHT,generateImage);
    int seqFlowX=centerOfRhombus + SEQUENCE_FLOW_WIDTH + TASK_WIDTH;
    SequenceFlow sequenceFlow2=outgoingSequenceFlowMapping.get(userTask.getId()).get(0);
    drawSequenceFlow(sequenceFlow2,generateImage,seqFlowX,currentHeight,seqFlowX + LONG_SEQUENCE_FLOW_WITHOUT_ARROW_WIDTH,currentHeight,seqFlowX + LONG_SEQUENCE_FLOW_WITHOUT_ARROW_WIDTH,y + GATEWAY_HEIGHT);
    handledElements.add(userTask.getId());
    currentHeight+=TASK_HEIGHT + TASK_HEIGHT_SPACING;
  }
  String someTaskId=sequenceFlows.get(0).getTargetRef();
  FlowElement join=process.getFlowElement(outgoingSequenceFlowMapping.get(someTaskId).get(0).getTargetRef());
  centerOfRhombus=centerOfRhombus + SEQUENCE_FLOW_WIDTH + TASK_WIDTH+ LONG_SEQUENCE_FLOW_WITHOUT_ARROW_WIDTH;
  drawParallelGateway(join,centerOfRhombus - GATEWAY_WIDTH / 2,y,GATEWAY_WIDTH,GATEWAY_HEIGHT,generateImage);
  handledElements.add(join.getId());
  currentWidth=originalCurrentWidth + TASK_BLOCK_WIDTH;
}
