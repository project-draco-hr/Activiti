{
  RuntimeSession runtimeSession=commandContext.getRuntimeSession();
  JobEntity job=runtimeSession.findJobById(jobId);
  job.setRetries(job.getRetries() - 1);
  job.setLockOwner(null);
  job.setLockExpirationTime(null);
  if (exception != null) {
    job.setExceptionMessage(exception.getMessage());
    job.setExceptionStacktrace(getExceptionStacktrace());
  }
  JobExecutor jobExecutor=Context.getProcessEngineConfiguration().getJobExecutor();
  MessageAddedNotification messageAddedNotification=new MessageAddedNotification(jobExecutor);
  TransactionContext transactionContext=commandContext.getTransactionContext();
  transactionContext.addTransactionListener(TransactionState.COMMITTED,messageAddedNotification);
  return null;
}
