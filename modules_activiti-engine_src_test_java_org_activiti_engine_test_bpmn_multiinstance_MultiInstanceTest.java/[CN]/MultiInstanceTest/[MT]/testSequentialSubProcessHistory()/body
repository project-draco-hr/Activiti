{
  runtimeService.startProcessInstanceByKey("miSequentialSubprocess");
  for (int i=0; i < 4; i++) {
    List<Task> tasks=taskService.createTaskQuery().list();
    taskService.complete(tasks.get(0).getId());
    taskService.complete(tasks.get(1).getId());
  }
  List<HistoricActivityInstance> onlySubProcessInstances=historyService.createHistoricActivityInstanceQuery().activityType("subProcess").list();
  assertEquals(4,onlySubProcessInstances.size());
  List<HistoricActivityInstance> allHistoricInstances=historyService.createHistoricActivityInstanceQuery().list();
  assertEquals(12,allHistoricInstances.size());
  for (  HistoricActivityInstance hai : allHistoricInstances) {
    assertNotNull(hai.getStartTime());
    assertNotNull(hai.getEndTime());
  }
}
