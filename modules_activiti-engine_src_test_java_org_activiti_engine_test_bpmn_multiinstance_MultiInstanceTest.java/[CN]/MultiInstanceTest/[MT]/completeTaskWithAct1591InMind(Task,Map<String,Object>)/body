{
  try {
    if (subVariables != null) {
      taskService.complete(task.getId(),subVariables);
    }
 else {
      taskService.complete(task.getId());
    }
  }
 catch (  Exception e) {
    CommandExecutor commandExecutor=processEngineConfiguration.getCommandExecutorTxRequired();
    commandExecutor.execute(new Command<Object>(){
      public Object execute(      CommandContext commandContext){
        IdentityLinkEntityManager identityLinkEntityManager=Context.getCommandContext().getIdentityLinkEntityManager();
        List<IdentityLinkEntity> identityLinks=identityLinkEntityManager.findIdentityLinks();
        for (        IdentityLinkEntity identityLink : identityLinks) {
          identityLinkEntityManager.delete(identityLink);
        }
        return null;
      }
    }
);
    if (subVariables != null) {
      taskService.complete(task.getId(),subVariables);
    }
 else {
      taskService.complete(task.getId());
    }
  }
}
