{
  DeploymentManager deploymentCache=commandContext.getProcessEngineConfiguration().getDeploymentManager();
  ProcessDefinitionEntity processDefinition=null;
  if (processDefinitionId != null) {
    processDefinition=deploymentCache.findDeployedProcessDefinitionById(processDefinitionId);
    if (processDefinition == null) {
      throw new ActivitiObjectNotFoundException("No process definition found for id = '" + processDefinitionId + "'",ProcessDefinition.class);
    }
  }
 else   if (processDefinitionKey != null && (tenantId == null || ProcessEngineConfiguration.NO_TENANT_ID.equals(tenantId))) {
    processDefinition=deploymentCache.findDeployedLatestProcessDefinitionByKey(processDefinitionKey);
    if (processDefinition == null) {
      throw new ActivitiObjectNotFoundException("No process definition found for key '" + processDefinitionKey + "'",ProcessDefinition.class);
    }
  }
 else   if (processDefinitionKey != null && tenantId != null && !ProcessEngineConfiguration.NO_TENANT_ID.equals(tenantId)) {
    processDefinition=deploymentCache.findDeployedLatestProcessDefinitionByKeyAndTenantId(processDefinitionKey,tenantId);
    if (processDefinition == null) {
      throw new ActivitiObjectNotFoundException("No process definition found for key '" + processDefinitionKey + "' for tenant identifier "+ tenantId,ProcessDefinition.class);
    }
  }
 else {
    throw new ActivitiIllegalArgumentException("processDefinitionKey and processDefinitionId are null");
  }
  if (processDefinition.isSuspended()) {
    throw new ActivitiException("Cannot start process instance. Process definition " + processDefinition.getName() + " (id = "+ processDefinition.getId()+ ") is suspended");
  }
  ExecutionEntity processInstance=processDefinition.createProcessInstance(businessKey);
  if (variables != null) {
    processInstance.setVariables(variables);
  }
  processInstance.start();
  return processInstance;
}
