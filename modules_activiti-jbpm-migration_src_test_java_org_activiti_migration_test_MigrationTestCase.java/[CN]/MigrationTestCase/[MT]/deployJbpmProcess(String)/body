{
  JbpmContext jbpmContext=jbpmConfiguration.createJbpmContext();
  try {
    Map<String,byte[]> files=new HashMap<String,byte[]>();
    String processDefinitionPath=packageName + "/processdefinition.xml";
    files.put("processdefinition.xml",readProcessResource(processDefinitionPath,true));
    String gpdPath=packageName + "/gpd.xml";
    byte[] gpdBytes=readProcessResource(gpdPath,false);
    if (gpdBytes != null) {
      files.put("gpd.xml",gpdBytes);
    }
    String imagePath=packageName + "/processimage.jpg";
    byte[] imageBytes=readProcessResource(imagePath,false);
    if (imageBytes != null) {
      files.put("processimage.jpg",imageBytes);
    }
    try {
      ProcessDefinition processDefinition=ProcessDefinition.parseParZipInputStream(ZipUtil.createZipInputStream(files));
      jbpmContext.deployProcessDefinition(processDefinition);
    }
 catch (    IOException e) {
      throw new ActivitiException("Couldn't create zip file",e);
    }
  }
  finally {
    jbpmContext.close();
  }
}
