{
  ExecutionImpl propagatingExecution=null;
  ActivityImpl activity=execution.getActivity();
  if (activity.isScope()) {
    ExecutionImpl parentScopeInstance=null;
    if (execution.isConcurrencyScope()) {
      parentScopeInstance=execution.getParent();
    }
 else {
      parentScopeInstance=execution.getParent().getParent();
    }
    if (parentScopeInstance.isActive()) {
      throw new UnsupportedOperationException("not implemented yet");
    }
 else {
      propagatingExecution=parentScopeInstance;
    }
    execution.destroyScope();
  }
 else {
    propagatingExecution=execution;
  }
  ScopeElementImpl nextOuterScopeElement=activity.getParent();
  TransitionImpl transition=execution.getTransition();
  ActivityImpl destination=transition.getDestination();
  if (transitionLeavesNextOuterScope(nextOuterScopeElement,destination)) {
    propagatingExecution.setActivity((ActivityImpl)nextOuterScopeElement);
    propagatingExecution.performOperation(TRANSITION_NOTIFY_LISTENER_END);
  }
 else {
    propagatingExecution.performOperation(TRANSITION_NOTIFY_LISTENER_TAKE);
  }
}
