{
  TaskEntity task=Context.getCommandContext().getTaskManager().findTaskById(taskId);
  if (task == null) {
    throw new ActivitiException("Cannot find task with id " + taskId);
  }
  if (IdentityLinkType.ASSIGNEE.equals(type)) {
    task.setAssignee(userId);
  }
 else {
    task.addIdentityLink(userId,groupId,type);
  }
  String authenticatedUserId=Authentication.getAuthenticatedUserId();
  CommentEntity comment=new CommentEntity();
  comment.setUserId(authenticatedUserId);
  comment.setType(CommentEntity.TYPE_EVENT);
  comment.setTime(ClockUtil.getCurrentTime());
  comment.setTaskId(taskId);
  comment.setAction(Event.ACTION_ADD_IDENTITY_LINK);
  comment.setMessage(new String[]{userId,groupId,type});
  commandContext.getCommentManager().insert(comment);
  return null;
}
