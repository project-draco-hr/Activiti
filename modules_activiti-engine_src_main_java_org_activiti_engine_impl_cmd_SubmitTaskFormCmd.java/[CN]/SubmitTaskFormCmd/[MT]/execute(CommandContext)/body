{
  if (taskId == null) {
    throw new ActivitiException("taskId is null");
  }
  TaskSession taskSession=commandContext.getTaskSession();
  TaskEntity task=taskSession.findTaskById(taskId);
  if (task == null) {
    throw new ActivitiException("Cannot find task with id " + taskId);
  }
  int historyLevel=commandContext.getProcessEngineConfiguration().getHistoryLevel();
  ExecutionEntity execution=task.getExecution();
  if (historyLevel >= ProcessEngineConfigurationImpl.HISTORYLEVEL_AUDIT && execution != null) {
    DbSqlSession dbSqlSession=commandContext.getSession(DbSqlSession.class);
    for (    String propertyId : properties.keySet()) {
      String propertyValue=properties.get(propertyId);
      HistoricFormPropertyEntity historicFormProperty=new HistoricFormPropertyEntity(execution,propertyId,propertyValue);
      dbSqlSession.insert(historicFormProperty);
    }
  }
  TaskFormHandler taskFormHandler=task.getTaskDefinition().getTaskFormHandler();
  taskFormHandler.submitFormProperties(properties,task.getExecution());
  task.complete();
  return null;
}
