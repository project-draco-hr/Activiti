{
  if (taskId == null) {
    throw new ActivitiException("taskId is null");
  }
  TaskSession taskSession=commandContext.getTaskSession();
  TaskEntity task=taskSession.findTaskById(taskId);
  if (task == null) {
    throw new ActivitiException("Cannot find task with id " + taskId);
  }
  TaskFormHandler taskFormHandler=task.getTaskDefinition().getTaskFormHandler();
  try {
    VariableMap.setExternalUpdate(Boolean.TRUE);
    taskFormHandler.submitTaskFormData(task,properties);
  }
  finally {
    VariableMap.setExternalUpdate(null);
  }
  task.complete();
  return null;
}
