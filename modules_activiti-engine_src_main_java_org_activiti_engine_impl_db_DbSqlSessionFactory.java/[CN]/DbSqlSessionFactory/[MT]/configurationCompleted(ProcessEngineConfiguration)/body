{
  this.databaseName=processEngineConfiguration.getDatabaseName();
  this.idGenerator=processEngineConfiguration.getIdGenerator();
  this.statementMappings=databaseSpecificStatements.get(processEngineConfiguration.getDatabaseName());
  DataSource dataSource=processEngineConfiguration.getDataSource();
  if (dataSource == null) {
    String jdbcDriver=processEngineConfiguration.getJdbcDriver();
    String jdbcUrl=processEngineConfiguration.getJdbcUrl();
    String jdbcUsername=processEngineConfiguration.getJdbcUsername();
    String jdbcPassword=processEngineConfiguration.getJdbcPassword();
    if ((jdbcDriver == null) || (jdbcUrl == null) || (jdbcUsername == null)) {
      throw new ActivitiException("DataSource or JDBC properties have to be specified in a process engine configuration");
    }
    PooledDataSource pooledDataSource=new PooledDataSource(ReflectUtil.getClassLoader(),jdbcDriver,jdbcUrl,jdbcUsername,jdbcPassword);
    pooledDataSource.forceCloseAll();
    dataSource=pooledDataSource;
  }
  TransactionFactory transactionFactory=null;
  if (processEngineConfiguration.isLocalTransactions()) {
    transactionFactory=new JdbcTransactionFactory();
  }
 else {
    transactionFactory=new ManagedTransactionFactory();
  }
  this.sqlSessionFactory=createSessionFactory(dataSource,transactionFactory);
}
