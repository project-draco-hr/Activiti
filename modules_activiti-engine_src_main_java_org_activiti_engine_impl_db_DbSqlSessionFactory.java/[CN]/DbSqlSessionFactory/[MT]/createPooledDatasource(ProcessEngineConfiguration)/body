{
  String jdbcDriver=processEngineConfiguration.getJdbcDriver();
  String jdbcUrl=processEngineConfiguration.getJdbcUrl();
  String jdbcUsername=processEngineConfiguration.getJdbcUsername();
  String jdbcPassword=processEngineConfiguration.getJdbcPassword();
  if ((jdbcDriver == null) || (jdbcUrl == null) || (jdbcUsername == null)) {
    throw new ActivitiException("DataSource or JDBC properties have to be specified in a process engine configuration");
  }
  PooledDataSource pooledDataSource=new PooledDataSource(ReflectUtil.getClassLoader(),jdbcDriver,jdbcUrl,jdbcUsername,jdbcPassword);
  int maxActiveConnections=processEngineConfiguration.getMaxActiveConnections();
  int maxIdleConnections=processEngineConfiguration.getMaxIdleConnections();
  int maxCheckoutTime=processEngineConfiguration.getMaxCheckoutTime();
  int maxWaitTime=processEngineConfiguration.getMaxWaitTime();
  if (maxActiveConnections > 0) {
    pooledDataSource.setPoolMaximumActiveConnections(maxActiveConnections);
  }
  if (maxIdleConnections > 0) {
    pooledDataSource.setPoolMaximumIdleConnections(maxIdleConnections);
  }
  if (maxCheckoutTime > 0) {
    pooledDataSource.setPoolMaximumCheckoutTime(maxCheckoutTime);
  }
  if (maxWaitTime > 0) {
    pooledDataSource.setPoolTimeToWait(maxWaitTime);
  }
  pooledDataSource.forceCloseAll();
  return pooledDataSource;
}
