{
  ProcessDefinitionImpl processDefinition=processDefinitionsById.get(processDefinitionId);
  if (processDefinition == null) {
    addProcessDefinition(persistenceSession,persistenceSession.findProcessDefinitionById(processDefinitionId));
    DeploymentImpl deployment=persistenceSession.findDeploymentByProcessDefinitionId(processDefinitionId);
    if (deployment != null) {
      deployerManager.deploy(deployment,CommandContextHolder.getCurrentCommandContext());
    }
  }
  processDefinition=processDefinitionsById.get(processDefinitionId);
  if (processDefinition != null) {
    return processDefinition;
  }
 else {
    throw new ActivitiException("Couldn't find process definiton with id " + processDefinitionId);
  }
}
