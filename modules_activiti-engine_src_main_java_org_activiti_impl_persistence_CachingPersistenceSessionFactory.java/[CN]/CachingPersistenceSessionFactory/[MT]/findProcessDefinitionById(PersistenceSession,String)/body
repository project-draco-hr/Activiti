{
  ProcessDefinitionImpl processDefinition=processDefinitionsById.get(processDefinitionId);
  if (processDefinition == null) {
    processDefinition=persistenceSession.findProcessDefinitionById(processDefinitionId);
    addProcessDefinition(persistenceSession,processDefinition);
    DeploymentImpl deployment=persistenceSession.findDeploymentByProcessDefinitionId(processDefinitionId);
    if (deployment != null) {
      deployerManager.deploy(deployment,createCachingPersistenceSession(persistenceSession));
    }
  }
  processDefinition=processDefinitionsById.get(processDefinitionId);
  if (processDefinition != null) {
    return processDefinition;
  }
 else {
    throw new ActivitiException("Couldn't find process definiton with id " + processDefinitionId);
  }
}
