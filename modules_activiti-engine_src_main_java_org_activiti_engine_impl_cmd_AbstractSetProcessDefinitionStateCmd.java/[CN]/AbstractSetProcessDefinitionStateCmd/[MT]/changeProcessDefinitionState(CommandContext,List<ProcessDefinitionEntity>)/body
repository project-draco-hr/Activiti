{
  for (  ProcessDefinitionEntity processDefinition : processDefinitions) {
    SuspensionStateUtil.setSuspensionState(processDefinition,getProcessDefinitionSuspensionState());
    Context.getProcessEngineConfiguration().getDeploymentCache().removeProcessDefinition(processDefinition.getId());
    if (includeProcessInstances) {
      int currentStartIndex=0;
      List<ProcessInstance> processInstances=fetchProcessInstancesPage(commandContext,processDefinition,currentStartIndex);
      while (processInstances.size() > 0) {
        for (        ProcessInstance processInstance : processInstances) {
          AbstractSetProcessInstanceStateCmd processInstanceCmd=getProcessInstanceChangeStateCmd(processInstance);
          processInstanceCmd.execute(commandContext);
        }
        currentStartIndex+=processInstances.size();
        processInstances=fetchProcessInstancesPage(commandContext,processDefinition,currentStartIndex);
      }
    }
  }
}
