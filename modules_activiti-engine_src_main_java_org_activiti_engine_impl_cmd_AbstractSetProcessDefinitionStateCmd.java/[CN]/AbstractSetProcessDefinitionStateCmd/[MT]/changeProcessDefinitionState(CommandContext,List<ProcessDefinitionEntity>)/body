{
  for (  ProcessDefinitionEntity processDefinition : processDefinitions) {
    SuspensionStateUtil.setSuspensionState(processDefinition,getProcessDefinitionSuspensionState());
    Context.getProcessEngineConfiguration().getDeploymentManager().getProcessDefinitionCache().remove(processDefinition.getId());
    if (includeProcessInstances) {
      int currentStartIndex=0;
      List<ProcessInstance> processInstances=fetchProcessInstancesPage(commandContext,processDefinition,currentStartIndex);
      while (processInstances.size() > 0) {
        for (        ProcessInstance processInstance : processInstances) {
          AbstractSetProcessInstanceStateCmd processInstanceCmd=getProcessInstanceChangeStateCmd(processInstance);
          processInstanceCmd.execute(commandContext);
        }
        currentStartIndex+=processInstances.size();
        processInstances=fetchProcessInstancesPage(commandContext,processDefinition,currentStartIndex);
      }
    }
    if (Context.getCommandContext().getEventDispatcher().isEnabled()) {
      ActivitiEventType eventType=null;
      if (getProcessDefinitionSuspensionState() == SuspensionState.ACTIVE) {
        eventType=ActivitiEventType.ENTITY_ACTIVATED;
      }
 else {
        eventType=ActivitiEventType.ENTITY_SUSPENDED;
      }
      Context.getCommandContext().getEventDispatcher().dispatchEvent(ActivitiEventBuilder.createEntityEvent(eventType,processDefinition));
    }
  }
}
