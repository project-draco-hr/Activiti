{
  try {
    Activity activity=mock(Activity.class);
    when(activity.getName()).thenReturn("activityName");
    when(activity.getType()).thenReturn("activityType");
    ProcessInstance processInstance=mock(ProcessInstance.class);
    when(processInstance.getProcessDefinitionId()).thenReturn("processDefinitionId");
    when(activity.getId()).thenReturn("activityIdOne");
    when(processInstance.getId()).thenReturn("processInstanceIdOne");
    fireActivityStartedEvent(processInstance,activity);
    try {
      fireActivityStartedEvent(processInstance,activity);
      fail("unique key constraint violation expected");
    }
 catch (    Exception expected) {
    }
    when(activity.getId()).thenReturn("activityIdTwo");
    when(processInstance.getId()).thenReturn("processInstanceIdOne");
    fireActivityStartedEvent(processInstance,activity);
    when(activity.getId()).thenReturn("activityIdOne");
    when(processInstance.getId()).thenReturn("processInstanceIdTwo");
    fireActivityStartedEvent(processInstance,activity);
    when(activity.getId()).thenReturn("activityIdTwo");
    when(processInstance.getId()).thenReturn("processInstanceIdTwo");
    fireActivityStartedEvent(processInstance,activity);
  }
  finally {
    cleanHistoricActivityInstancesFromDatabase("activityIdOne","processInstanceIdOne");
    cleanHistoricActivityInstancesFromDatabase("activityIdTwo","processInstanceIdOne");
    cleanHistoricActivityInstancesFromDatabase("activityIdOne","processInstanceIdTwo");
    cleanHistoricActivityInstancesFromDatabase("activityIdTwo","processInstanceIdTwo");
  }
}
