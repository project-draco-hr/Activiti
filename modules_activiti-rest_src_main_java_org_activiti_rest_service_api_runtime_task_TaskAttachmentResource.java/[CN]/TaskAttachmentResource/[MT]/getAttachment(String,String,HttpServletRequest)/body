{
  HistoricTaskInstance task=getHistoricTaskFromRequest(taskId);
  Attachment attachment=taskService.getAttachment(attachmentId);
  if (attachment == null || !task.getId().equals(attachment.getTaskId())) {
    throw new ActivitiObjectNotFoundException("Task '" + task.getId() + "' doesn't have an attachment with id '"+ attachmentId+ "'.",Comment.class);
  }
  String serverRootUrl=request.getRequestURL().toString();
  serverRootUrl=serverRootUrl.substring(0,serverRootUrl.indexOf("/runtime/tasks/"));
  return restResponseFactory.createAttachmentResponse(attachment,serverRootUrl);
}
