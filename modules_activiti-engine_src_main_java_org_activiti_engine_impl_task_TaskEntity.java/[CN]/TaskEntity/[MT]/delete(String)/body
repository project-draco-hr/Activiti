{
  if (!isDeleted) {
    isDeleted=true;
    for (    IdentityLinkEntity identityLinkEntities : getIdentityLinks()) {
      identityLinkEntities.delete();
    }
    ensureVariableInstancesInitialized();
    for (    VariableInstanceEntity variableInstance : variableInstances.values()) {
      variableInstance.delete();
    }
    CommandContext commandContext=CommandContext.getCurrent();
    DbSqlSession dbSqlSession=commandContext.getDbSqlSession();
    int historyLevel=commandContext.getProcessEngineConfiguration().getHistoryLevel();
    if (historyLevel >= ProcessEngineConfigurationImpl.HISTORYLEVEL_AUDIT) {
      HistoricTaskInstanceEntity historicTaskInstance=dbSqlSession.selectById(HistoricTaskInstanceEntity.class,id);
      if (historicTaskInstance != null) {
        historicTaskInstance.markEnded(deleteReason);
      }
    }
    dbSqlSession.delete(TaskEntity.class,id);
  }
}
