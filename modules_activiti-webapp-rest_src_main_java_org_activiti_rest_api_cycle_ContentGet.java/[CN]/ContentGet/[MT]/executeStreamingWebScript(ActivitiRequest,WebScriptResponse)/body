{
  init(req);
  String artifactId=req.getMandatoryString("artifactId");
  String contentRepresentationId=req.getMandatoryString("contentRepresentationId");
  RepositoryArtifact artifact=repositoryConnector.getRepositoryArtifact(artifactId);
  ContentRepresentation contentRepresentation=artifact.getArtifactType().getContentRepresentation(contentRepresentationId);
  String contentType=contentRepresentation.getMimeType().getContentType();
  boolean attach=contentType.startsWith("application/") ? true : false;
  String attachmentFileName=null;
  if (attach) {
    attachmentFileName=artifact.getMetadata().getName();
    if (contentType.equals(CycleDefaultMimeType.XML) && !attachmentFileName.endsWith(".xml")) {
      attachmentFileName+=".xml";
    }
 else     if (contentType.equals(CycleDefaultMimeType.JSON) && !attachmentFileName.endsWith(".json")) {
      attachmentFileName+=".json";
    }
 else     if (contentType.equals(CycleDefaultMimeType.TEXT) && !attachmentFileName.endsWith(".txt")) {
      attachmentFileName+=".txt";
    }
 else     if (contentType.equals(CycleDefaultMimeType.PDF) && !attachmentFileName.endsWith(".pdf")) {
      attachmentFileName+=".pdf";
    }
 else     if (contentType.equals(CycleDefaultMimeType.MS_EXCEL) && !attachmentFileName.endsWith(".xls")) {
      attachmentFileName+=".xls";
    }
 else     if (contentType.equals(CycleDefaultMimeType.MS_POWERPOINT) && !attachmentFileName.endsWith(".ppt")) {
      attachmentFileName+=".ppt";
    }
 else     if (contentType.equals(CycleDefaultMimeType.MS_WORD) && !attachmentFileName.endsWith(".doc")) {
      attachmentFileName+=".doc";
    }
  }
  streamResponse(res,repositoryConnector.getContent(artifact.getId(),contentRepresentation.getId()).asInputStream(),new Date(0),"W/\"647-1281077702000\"",attach,attachmentFileName,contentType);
}
