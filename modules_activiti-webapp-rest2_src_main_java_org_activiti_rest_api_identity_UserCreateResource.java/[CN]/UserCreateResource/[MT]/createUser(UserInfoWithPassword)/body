{
  if (authenticate() == false)   return null;
  IdentityService identityService=ActivitiUtil.getIdentityService();
  if (userInfo == null || userInfo.getId() == null) {
    throw new ActivitiException("No user id supplied");
  }
  if (identityService.createUserQuery().userId(userInfo.getId()).count() == 0) {
    User user=identityService.newUser(userInfo.getId());
    user.setFirstName(userInfo.getFirstName());
    user.setLastName(userInfo.getLastName());
    user.setPassword(userInfo.getPassword());
    user.setEmail(userInfo.getEmail());
    identityService.saveUser(user);
  }
 else {
    throw new ActivitiException("user id must be unique");
  }
  return new StateResponse().setSuccess(true);
}
