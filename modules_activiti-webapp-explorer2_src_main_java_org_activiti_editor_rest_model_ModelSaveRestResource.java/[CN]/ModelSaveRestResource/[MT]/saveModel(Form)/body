{
  ObjectMapper objectMapper=new ObjectMapper();
  String modelId=(String)getRequest().getAttributes().get("modelId");
  try {
    ModelDao modelDao=new ModelDao();
    ModelData model=modelDao.getModelById(Long.valueOf(modelId));
    ObjectNode modelJson=(ObjectNode)objectMapper.readTree(model.getModelJson());
    modelJson.put(MODEL_NAME,modelForm.getFirstValue("name"));
    modelJson.put(MODEL_DESCRIPTION,modelForm.getFirstValue("description"));
    model.setModelJson(modelJson.toString());
    model.setModelEditorJson(modelForm.getFirstValue("json_xml"));
    model.setModelSvg(new String(modelForm.getFirstValue("svg_xml").getBytes("utf-8")));
    modelDao.saveModel(model);
  }
 catch (  Exception e) {
    LOGGER.log(Level.SEVERE,"Error saving model",e);
    setStatus(Status.SERVER_ERROR_INTERNAL);
  }
}
