{
  ProcessDefinitionImpl processDefinition=((ExecutionEntity)execution).getProcessDefinition();
  ActivityImpl borderEventActivity=processDefinition.findActivity(borderEventActivityId);
  if (borderEventActivity == null) {
    throw new ActivitiException(borderEventActivityId + " not found in process definition");
  }
  ActivityImpl catchingScope=borderEventActivity.getParentActivity();
  if (catchingScope == null) {
    throw new ActivitiException(borderEventActivityId + " is suppossed to be a nested activity, " + "but no parent activity can be found.");
  }
  boolean matchingParentFound=false;
  ActivityExecution leavingExecution=execution;
  String multiInstance=(String)catchingScope.getProperty("multiInstance");
  ActivityImpl currentActivity=(multiInstance == null || "sequential".equals(multiInstance)) ? (ActivityImpl)execution.getActivity().getParent() : (ActivityImpl)execution.getActivity();
  while (!matchingParentFound && leavingExecution != null && currentActivity != null) {
    if (leavingExecution.isScope() && !leavingExecution.isConcurrent() && currentActivity.getId().equals(catchingScope.getId())) {
      matchingParentFound=true;
    }
 else     if (leavingExecution.isConcurrent()) {
      leavingExecution=leavingExecution.getParent();
    }
 else {
      currentActivity=currentActivity.getParentActivity();
      leavingExecution=leavingExecution.getParent();
    }
  }
  if (matchingParentFound && leavingExecution != null) {
    leavingExecution.executeActivity(borderEventActivity);
  }
 else {
    throw new ActivitiException("No matching parent execution for activity " + borderEventActivityId + " found");
  }
}
