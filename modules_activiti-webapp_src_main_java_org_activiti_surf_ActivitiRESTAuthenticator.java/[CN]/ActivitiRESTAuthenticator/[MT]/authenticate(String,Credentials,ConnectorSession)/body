{
  ConnectorSession cs=null;
  if (credentials != null) {
    RemoteClient remoteClient=new RemoteClient(endpoint);
    String userId=(String)credentials.getProperty(Credentials.CREDENTIAL_USERNAME);
    String password=(String)credentials.getProperty(Credentials.CREDENTIAL_PASSWORD);
    remoteClient.setRequestContentType("application/json");
    JSONObject json=new JSONObject();
    try {
      json.put("userId",userId);
      json.put("password",password);
    }
 catch (    JSONException e) {
      throw new AuthenticationException("Unable to create json login request",e);
    }
    Response response=remoteClient.call("/login",json.toString());
    if (response.getStatus().getCode() == 200) {
      try {
        json=new JSONObject(response.getResponse());
        if (json.getBoolean("success")) {
          if (connectorSession != null) {
            connectorSession.setParameter(ACTIVITI_REST_AUTHORISED_KEY,"true");
            cs=connectorSession;
          }
        }
      }
 catch (      JSONException e) {
        throw new AuthenticationException("Unable to validate login",e);
      }
    }
 else {
      try {
        json=new JSONObject(response.getResponse());
        throw new AuthenticationException(json.getString("message"));
      }
 catch (      JSONException e) {
        throw new AuthenticationException("Unable to login:" + response.getResponse());
      }
    }
  }
 else {
    throw new AuthenticationException("Unable to validate login since username and password wasn't provided");
  }
  return cs;
}
