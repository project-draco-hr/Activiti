{
  if (LOG.isLoggable(Level.FINE)) {
    LOG.fine("Leaving activity '" + execution.getActivity().getId() + "'");
  }
  List<Transition> outgoingSequenceFlow=execution.getOutgoingTransitions();
  if (outgoingSequenceFlow.size() == 1) {
    execution.take(outgoingSequenceFlow.get(0));
  }
 else   if (outgoingSequenceFlow.size() > 1) {
    Map<ActivityExecution,Transition> childExecutionMapping=new LinkedHashMap<ActivityExecution,Transition>();
    ConcurrencyController concurrencyController=execution.getConcurrencyController();
    for (    Transition outSeqFlow : outgoingSequenceFlow) {
      if (outSeqFlow.getCondition() == null || !checkConditions || outSeqFlow.getCondition().evaluate(execution)) {
        ActivityExecution concurrentExecution=concurrencyController.createExecution();
        childExecutionMapping.put(concurrentExecution,outSeqFlow);
      }
    }
    execution.setActive(false);
    execution.setActivity(null);
    for (    Map.Entry<ActivityExecution,Transition> entry : childExecutionMapping.entrySet()) {
      entry.getKey().take(entry.getValue());
    }
  }
 else {
    if (LOG.isLoggable(Level.FINE)) {
      LOG.fine("No outgoing sequence flow found for " + execution.getActivity().getId() + ". Ending execution.");
    }
    execution.end();
  }
}
