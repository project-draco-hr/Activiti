{
  List<HistoricActivityInstance> activityList=ActivitiUtil.getHistoryService().createHistoricActivityInstanceQuery().processInstanceId(processInstanceId).orderByHistoricActivityInstanceStartTime().asc().list();
  if (activityList != null && activityList.size() > 0) {
    ArrayNode activitiesJSON=new ObjectMapper().createArrayNode();
    responseJSON.put("activities",activitiesJSON);
    for (    HistoricActivityInstance historicActivityInstance : activityList) {
      ObjectNode activityJSON=new ObjectMapper().createObjectNode();
      activityJSON.put("activityId",historicActivityInstance.getActivityId());
      activityJSON.put("activityName",historicActivityInstance.getActivityName() != null ? historicActivityInstance.getActivityName() : "null");
      activityJSON.put("activityType",historicActivityInstance.getActivityType());
      activityJSON.put("startTime",RequestUtil.dateToString(historicActivityInstance.getStartTime()));
      if (historicActivityInstance.getEndTime() == null) {
        activityJSON.put("completed",false);
      }
 else {
        activityJSON.put("completed",true);
        activityJSON.put("endTime",RequestUtil.dateToString(historicActivityInstance.getEndTime()));
        activityJSON.put("duration",historicActivityInstance.getDurationInMillis());
      }
      activitiesJSON.add(activityJSON);
    }
  }
}
