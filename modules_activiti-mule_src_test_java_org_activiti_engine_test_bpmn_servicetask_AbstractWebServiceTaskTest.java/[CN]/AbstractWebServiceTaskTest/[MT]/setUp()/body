{
  super.setUp();
  MuleContextFactory muleContextFactory=new DefaultMuleContextFactory();
  List<ConfigurationBuilder> builders=new ArrayList<ConfigurationBuilder>();
  builders.add(new SpringXmlConfigurationBuilder("org/activiti/test/mule/mule-cxf-webservice-config.xml"));
  MuleContextBuilder contextBuilder=new DefaultMuleContextBuilder();
  context=muleContextFactory.createMuleContext(builders,contextBuilder);
  context.start();
  DeploymentBuilder deploymentBuilder=processEngine.getRepositoryService().createDeployment().name(ClassNameUtil.getClassNameWithoutPackage(this.getClass()) + "." + this.getName());
  String resource=TestHelper.getBpmnProcessDefinitionResource(this.getClass(),this.getName());
  deploymentBuilder.addClasspathResource(resource);
  DeploymentBuilderImpl impl=(DeploymentBuilderImpl)deploymentBuilder;
  impl.getDeployment().setValidatingSchema(this.isValidating());
  deploymentId=deploymentBuilder.deploy().getId();
  counter=(Counter)((DefaultJavaComponent)context.getRegistry().lookupService("counterService").getComponent()).getObjectFactory().getInstance();
  counter.initialize();
}
