{
  ProcessInstance processInstance=runtimeService.startProcessInstanceByKey("oneTaskProcess");
  runtimeService.setVariable(processInstance.getId(),"variableSetinProcess","Hello world");
  Task task=taskService.createTaskQuery().processInstanceId(processInstance.getId()).singleResult();
  taskService.complete(task.getId(),Collections.singletonMap("variableSetInTask",(Object)"Activiti rocks"));
  List<HistoricDetail> details=historyService.createHistoricDetailQuery().processInstanceId(processInstance.getId()).list();
  assertEquals(2,details.size());
  assertNotNull(details.get(0).getActivityInstanceId());
  assertNotNull(details.get(1).getActivityInstanceId());
}
