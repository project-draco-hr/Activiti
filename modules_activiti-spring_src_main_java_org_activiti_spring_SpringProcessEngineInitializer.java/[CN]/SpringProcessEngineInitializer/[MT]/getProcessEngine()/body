{
  log.fine("==== BUILDING SPRING APPLICATION CONTEXT AND PROCESS ENGINE =========================================");
  String contextResourceName=null;
  if (ReflectUtil.getResource("activiti-engine-testsuite-context.xml") != null) {
    contextResourceName="activiti-engine-testsuite-context.xml";
  }
 else   if (ReflectUtil.getResource("activiti-context.xml") != null) {
    contextResourceName="activiti-context.xml";
  }
 else {
    throw new ActivitiException("no spring context configuration file found (tried 'activiti-context.xml' and 'activiti-engine-testsuite-context.xml')");
  }
  ApplicationContext applicationContext=new ClassPathXmlApplicationContext(contextResourceName);
  Map<String,ProcessEngine> beansOfType=applicationContext.getBeansOfType(ProcessEngine.class);
  if ((beansOfType == null) || (beansOfType.isEmpty())) {
    throw new ActivitiException("no " + ProcessEngine.class.getName() + " defined in the application context activiti-context.xml");
  }
  ProcessEngine processEngine=beansOfType.values().iterator().next();
  log.fine("==== SPRING PROCESS ENGINE CREATED ==================================================================");
  return processEngine;
}
