{
  if (!(activity.getActivityBehavior() instanceof AbstractBpmnActivityBehavior)) {
    return;
  }
  Element miLoopCharacteristics=activityElement.element("multiInstanceLoopCharacteristics");
  if (miLoopCharacteristics != null) {
    boolean isSequential=parseBooleanAttribute(miLoopCharacteristics.attribute("isSequential"),false);
    MultiInstanceActivityBehavior miActivityBehavior=new MultiInstanceActivityBehavior((AbstractBpmnActivityBehavior)activity.getActivityBehavior(),isSequential);
    activity.setScope(true);
    activity.setActivityBehavior(miActivityBehavior);
    Element loopCardinality=miLoopCharacteristics.element("loopCardinality");
    if (loopCardinality != null) {
      String loopCardinalityText=loopCardinality.getText();
      if (loopCardinalityText == null || "".equals(loopCardinalityText)) {
        addError("loopCardinality must be defined for a multiInstanceLoopCharacteristics definition ",miLoopCharacteristics);
      }
      miActivityBehavior.setLoopCardinalityExpression(expressionManager.createExpression(loopCardinalityText));
    }
    Element completionCondition=miLoopCharacteristics.element("completionCondition");
    if (completionCondition != null) {
      String completionConditionText=completionCondition.getText();
      miActivityBehavior.setCompletionConditionExpression(expressionManager.createExpression(completionConditionText));
    }
    for (    BpmnParseListener parseListener : parseListeners) {
      parseListener.parseMultiInstanceLoopCharacteristics(activityElement,miLoopCharacteristics,activity);
    }
  }
}
