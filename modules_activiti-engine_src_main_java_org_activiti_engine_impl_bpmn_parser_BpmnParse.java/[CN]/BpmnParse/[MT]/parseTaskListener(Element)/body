{
  TaskListener taskListener=null;
  String className=taskListenerElement.attribute("class");
  String expression=taskListenerElement.attribute("expression");
  if (className != null && className.trim().length() > 0) {
    Object delegateInstance=instantiateDelegate(className,parseFieldDeclarations(taskListenerElement));
    if (delegateInstance instanceof TaskListener) {
      taskListener=(TaskListener)delegateInstance;
    }
 else {
      addError(delegateInstance.getClass().getName() + " doesn't implement " + TaskListener.class,taskListenerElement);
    }
  }
 else   if (expression != null && expression.trim().length() > 0) {
    taskListener=new ExpressionTaskListener(expressionManager.createExpression(expression));
  }
 else {
    addError("Element 'class' or 'expression' is mandatory on taskListener",taskListenerElement);
  }
  return taskListener;
}
