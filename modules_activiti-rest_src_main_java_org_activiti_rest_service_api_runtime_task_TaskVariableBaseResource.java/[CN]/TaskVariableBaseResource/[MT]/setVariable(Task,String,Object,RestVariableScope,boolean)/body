{
  boolean hasVariable=hasVariableOnScope(task,name,scope);
  if (isNew && hasVariable) {
    throw new ResourceException(new Status(Status.CLIENT_ERROR_CONFLICT.getCode(),"Variable '" + name + "' is already present on task '"+ task.getId()+ "'.",null,null));
  }
  if (!isNew && !hasVariable) {
    throw new ActivitiObjectNotFoundException("Task '" + task.getId() + "' doesn't have a variable with name: '"+ name+ "'.",null);
  }
  if (scope == RestVariableScope.LOCAL) {
    ActivitiUtil.getTaskService().setVariableLocal(task.getId(),name,value);
  }
 else {
    if (task.getExecutionId() != null) {
      ActivitiUtil.getRuntimeService().setVariable(task.getExecutionId(),name,value);
    }
 else {
      throw new ActivitiIllegalArgumentException("Cannot set global variable '" + name + "' on task '"+ task.getId()+ "', task is not part of process.");
    }
  }
}
