{
  Object result=null;
  if (file != null) {
    result=setBinaryVariable(file,requestParams,execution,true,serverRootUrl);
  }
 else {
    List<RestVariable> variables=new ArrayList<RestVariable>();
    result=variables;
    if (restVariables == null || restVariables.size() == 0) {
      throw new ActivitiIllegalArgumentException("Request didn't contain a list of variables to create.");
    }
    RestVariableScope sharedScope=null;
    RestVariableScope varScope=null;
    Map<String,Object> variablesToSet=new HashMap<String,Object>();
    for (    RestVariable var : restVariables) {
      varScope=var.getVariableScope();
      if (var.getName() == null) {
        throw new ActivitiIllegalArgumentException("Variable name is required");
      }
      if (varScope == null) {
        varScope=RestVariableScope.LOCAL;
      }
      if (sharedScope == null) {
        sharedScope=varScope;
      }
      if (varScope != sharedScope) {
        throw new ActivitiIllegalArgumentException("Only allowed to update multiple variables in the same scope.");
      }
      if (!override && hasVariableOnScope(execution,var.getName(),varScope)) {
        throw new ActivitiException("Variable '" + var.getName() + "' is already present on execution '"+ execution.getId()+ "'.");
      }
      Object actualVariableValue=restResponseFactory.getVariableValue(var);
      variablesToSet.put(var.getName(),actualVariableValue);
      variables.add(restResponseFactory.createRestVariable(var.getName(),actualVariableValue,varScope,execution.getId(),RestResponseFactory.VARIABLE_EXECUTION,false,serverRootUrl));
    }
    if (!variablesToSet.isEmpty()) {
      if (sharedScope == RestVariableScope.LOCAL) {
        runtimeService.setVariablesLocal(execution.getId(),variablesToSet);
      }
 else {
        if (execution.getParentId() != null) {
          runtimeService.setVariables(execution.getParentId(),variablesToSet);
        }
 else {
          throw new ActivitiIllegalArgumentException("Cannot set global variables on execution '" + execution.getId() + "', task is not part of process.");
        }
      }
    }
  }
  response.setStatus(HttpStatus.SC_CREATED);
  return result;
}
