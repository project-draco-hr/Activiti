{
  if (databaseName == null) {
    throw new ActivitiException("no database name specified (used to look up queries and scripts)");
  }
  ProcessEngineConfiguration processEngineConfiguration=new ProcessEngineConfiguration();
  processEngineConfiguration.setProcessEngineName(processEngineName);
  processEngineConfiguration.setDbSchemaStrategy(dbSchemaStrategy);
  processEngineConfiguration.setJobExecutorAutoActivate(jobExecutorAutoActivate);
  IdGenerator idGenerator=processEngineConfiguration.getIdGenerator();
  PersistenceSessionFactory persistenceSessionFactory;
  if (jdbcDriver == null) {
    throw new ActivitiException("no jdbc driver specified");
  }
  if (jdbcUrl == null) {
    throw new ActivitiException("no jdbc url specified");
  }
  if (jdbcUsername == null) {
    throw new ActivitiException("no jdbc username specified");
  }
  if (jdbcPassword == null) {
    throw new ActivitiException("no jdbc password specified");
  }
  persistenceSessionFactory=new IbatisPersistenceSessionFactory(processEngineConfiguration.getVariableTypes(),idGenerator,databaseName,jdbcDriver,jdbcUrl,jdbcUsername,jdbcPassword);
  persistenceSessionFactory=new CachingPersistenceSessionFactory(persistenceSessionFactory,Thread.currentThread().getContextClassLoader());
  processEngineConfiguration.setPersistenceSessionFactory(persistenceSessionFactory);
  return processEngineConfiguration.buildProcessEngine();
}
