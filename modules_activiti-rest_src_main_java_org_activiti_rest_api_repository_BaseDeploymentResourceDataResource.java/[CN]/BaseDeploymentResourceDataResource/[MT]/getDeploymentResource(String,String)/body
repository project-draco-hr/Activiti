{
  if (deploymentId == null) {
    throw new ActivitiIllegalArgumentException("No deployment id provided");
  }
  if (resourceId == null) {
    throw new ActivitiIllegalArgumentException("No resource id provided");
  }
  Deployment deployment=ActivitiUtil.getRepositoryService().createDeploymentQuery().deploymentId(deploymentId).singleResult();
  if (deployment == null) {
    throw new ActivitiObjectNotFoundException("Could not find a deployment with id '" + deploymentId + "'.",Deployment.class);
  }
  List<String> resourceList=ActivitiUtil.getRepositoryService().getDeploymentResourceNames(deploymentId);
  if (resourceList.contains(resourceId)) {
    final InputStream resourceStream=ActivitiUtil.getRepositoryService().getResourceAsStream(deploymentId,resourceId);
    MediaType mediaType=null;
    String lowerResourceName=resourceId.toLowerCase();
    if (lowerResourceName.endsWith("png")) {
      mediaType=MediaType.IMAGE_PNG;
    }
 else     if (lowerResourceName.endsWith("xml") || lowerResourceName.endsWith("bpmn")) {
      mediaType=MediaType.TEXT_XML;
    }
 else {
      mediaType=MediaType.APPLICATION_ALL;
    }
    return new InputRepresentation(resourceStream,mediaType);
  }
 else {
    throw new ActivitiObjectNotFoundException("Could not find a resource with id '" + resourceId + "' in deployment '"+ deploymentId+ "'.",String.class);
  }
}
