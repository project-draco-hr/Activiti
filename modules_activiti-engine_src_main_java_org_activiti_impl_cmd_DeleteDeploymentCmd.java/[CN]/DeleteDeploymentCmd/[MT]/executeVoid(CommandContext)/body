{
  RepositorySession repositorySession=commandContext.getRepositorySession();
  PersistenceSession persistenceSession=commandContext.getPersistenceSession();
  List<ProcessDefinitionEntity> processDefinitions=repositorySession.findUndeployedProcessDefinitionsByDeploymentId(deploymentId);
  for (  ProcessDefinitionEntity processDefinition : processDefinitions) {
    List<DbExecutionImpl> executions=persistenceSession.findProcessInstancesByProcessDefintionId(processDefinition.getId());
    for (    DbExecutionImpl execution : executions) {
      execution.end();
    }
  }
  repositorySession.deleteDeployment(deploymentId);
}
