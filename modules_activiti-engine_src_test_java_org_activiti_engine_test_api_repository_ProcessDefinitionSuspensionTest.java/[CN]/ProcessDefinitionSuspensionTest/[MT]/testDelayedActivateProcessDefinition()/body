{
  Date startTime=new Date();
  ClockUtil.setCurrentTime(startTime);
  ProcessDefinition processDefinition=repositoryService.createProcessDefinitionQuery().singleResult();
  repositoryService.suspendProcessDefinitionById(processDefinition.getId());
  try {
    runtimeService.startProcessInstanceById(processDefinition.getId());
    fail();
  }
 catch (  ActivitiException e) {
    assertTextPresentIgnoreCase("suspended",e.getMessage());
  }
  assertEquals(0,runtimeService.createProcessInstanceQuery().count());
  assertEquals(0,repositoryService.createProcessDefinitionQuery().active().count());
  assertEquals(1,repositoryService.createProcessDefinitionQuery().suspended().count());
  long oneDayFromStart=startTime.getTime() + (24 * 60 * 60* 1000);
  repositoryService.activateProcessDefinitionById(processDefinition.getId(),false,new Date(oneDayFromStart));
  long twoDaysFromStart=startTime.getTime() + (2 * 24 * 60* 60* 1000);
  ClockUtil.setCurrentTime(new Date(twoDaysFromStart));
  waitForJobExecutorToProcessAllJobs(5000L,50L);
  runtimeService.startProcessInstanceById(processDefinition.getId());
  assertEquals(1,runtimeService.createProcessInstanceQuery().count());
  assertEquals(1,repositoryService.createProcessDefinitionQuery().active().count());
  assertEquals(0,repositoryService.createProcessDefinitionQuery().suspended().count());
}
