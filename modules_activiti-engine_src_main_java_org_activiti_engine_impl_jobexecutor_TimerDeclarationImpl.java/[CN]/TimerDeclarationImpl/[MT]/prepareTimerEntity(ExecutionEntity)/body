{
  BusinessCalendar businessCalendar=Context.getProcessEngineConfiguration().getBusinessCalendarManager().getBusinessCalendar(type.caledarName);
  if (description == null) {
    throw new ActivitiException("Timer '" + executionEntity.getActivityId() + "' was not configured with a valid duration/time");
  }
  String dueDateString=executionEntity == null ? description.getExpressionText() : (String)description.getValue(executionEntity);
  Date duedate=businessCalendar.resolveDuedate(dueDateString);
  TimerEntity timer=new TimerEntity(this);
  timer.setDuedate(duedate);
  if (executionEntity != null) {
    timer.setExecution(executionEntity);
  }
  if (type == TimerDeclarationType.CYCLE) {
    String prepared=prepareRepeat(dueDateString);
    timer.setRepeat(prepared);
  }
  return timer;
}
