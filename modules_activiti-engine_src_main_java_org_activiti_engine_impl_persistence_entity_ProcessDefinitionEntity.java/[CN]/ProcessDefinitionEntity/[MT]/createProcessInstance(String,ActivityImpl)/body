{
  ExecutionEntity processInstance=null;
  if (initial == null) {
    processInstance=(ExecutionEntity)super.createProcessInstance();
  }
 else {
    processInstance=(ExecutionEntity)super.createProcessInstanceForInitial(initial);
  }
  processInstance.setExecutions(new ArrayList<ExecutionEntity>());
  processInstance.setProcessDefinition(processDefinition);
  if (businessKey != null) {
    processInstance.setBusinessKey(businessKey);
  }
  processInstance.setProcessInstance(processInstance);
  String initiatorVariableName=(String)getProperty(BpmnParse.PROPERTYNAME_INITIATOR_VARIABLE_NAME);
  if (initiatorVariableName != null) {
    String authenticatedUserId=Authentication.getAuthenticatedUserId();
    processInstance.setVariable(initiatorVariableName,authenticatedUserId);
  }
  Context.getCommandContext().getHistoryManager().recordProcessInstanceStart(processInstance);
  return processInstance;
}
