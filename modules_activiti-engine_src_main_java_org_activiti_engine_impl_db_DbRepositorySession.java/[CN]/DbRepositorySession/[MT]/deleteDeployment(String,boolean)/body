{
  if (cascade) {
    CommandContext commandContext=Context.getCommandContext();
    List<ProcessDefinition> processDefinitions=new ProcessDefinitionQueryImpl(commandContext).deploymentId(deploymentId).list();
    int historyLevel=Context.getProcessEngineConfiguration().getHistoryLevel();
    boolean isHistoryEnabled=historyLevel >= ProcessEngineConfigurationImpl.HISTORYLEVEL_ACTIVITY;
    for (    ProcessDefinition processDefinition : processDefinitions) {
      if (isHistoryEnabled) {
        deleteHistoricProcessInstances(commandContext,processDefinition);
      }
      deleteProcessInstances(commandContext,processDefinition);
    }
  }
  dbSqlSession.delete("deleteProcessDefinitionsByDeploymentId",deploymentId);
  dbSqlSession.delete("deleteResourcesByDeploymentId",deploymentId);
  dbSqlSession.delete("deleteDeployment",deploymentId);
}
