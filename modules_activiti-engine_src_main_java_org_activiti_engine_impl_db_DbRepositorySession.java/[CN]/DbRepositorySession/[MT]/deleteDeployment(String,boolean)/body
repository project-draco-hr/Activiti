{
  if (cascade) {
    CommandContext commandContext=CommandContext.getCurrent();
    List<ProcessDefinition> processDefinitions=new ProcessDefinitionQueryImpl().deploymentId(deploymentId).executeList(commandContext,null);
    int historyLevel=commandContext.getProcessEngineConfiguration().getHistoryLevel();
    boolean isHistoryEnabled=historyLevel >= ProcessEngineConfiguration.HISTORYLEVEL_ACTIVITY;
    for (    ProcessDefinition processDefinition : processDefinitions) {
      if (isHistoryEnabled) {
        deleteHistoricProcessInstances(commandContext,processDefinition);
      }
      deleteProcessInstances(commandContext,processDefinition);
    }
  }
  dbSqlSession.delete("deleteProcessDefinitionsByDeploymentId",deploymentId);
  dbSqlSession.delete("deleteResourcesByDeploymentId",deploymentId);
  dbSqlSession.delete("deleteDeployment",deploymentId);
}
