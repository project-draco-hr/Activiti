{
  ExecutionEntity processInstance=(ExecutionEntity)super.createProcessInstance();
  CommandContext commandContext=CommandContext.getCurrent();
  commandContext.getDbSqlSession().insert(processInstance);
  processInstance.setExecutions(new ArrayList<ExecutionEntity>());
  processInstance.setProcessDefinition(processDefinition);
  if (businessKey != null) {
    processInstance.setBusinessKey(businessKey);
  }
  processInstance.setProcessInstance(processInstance);
  String initiatorVariableName=(String)getProperty("initiatorVariableName");
  if (initiatorVariableName != null) {
    String authenticatedUserId=Authentication.getAuthenticatedUserId();
    processInstance.setVariable(initiatorVariableName,authenticatedUserId);
  }
  int historyLevel=commandContext.getProcessEngineConfiguration().getHistoryLevel();
  if (historyLevel >= ProcessEngineConfigurationImpl.HISTORYLEVEL_ACTIVITY) {
    DbSqlSession dbSqlSession=commandContext.getSession(DbSqlSession.class);
    HistoricProcessInstanceEntity historicProcessInstance=new HistoricProcessInstanceEntity(processInstance);
    dbSqlSession.insert(historicProcessInstance);
  }
  return processInstance;
}
