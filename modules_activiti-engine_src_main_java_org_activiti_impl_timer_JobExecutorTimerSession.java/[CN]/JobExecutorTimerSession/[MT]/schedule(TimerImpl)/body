{
  Date duedate=timer.getDuedate();
  if (duedate == null) {
    throw new ActivitiException("duedate is null");
  }
  commandContext.getPersistenceSession().insert(timer);
  int waitTimeInMillis=jobExecutor.getWaitTimeInMillis();
  if (duedate.getTime() < (Clock.getCurrentTime().getTime() + waitTimeInMillis)) {
    commandContext.getTransactionContext().addTransactionListener(TransactionState.COMMITTED,new MessageAddedNotification(jobExecutor));
  }
}
