{
  Map<String,Object> model=new HashMap<String,Object>();
  model.put("iso8601Date",new ISO8601DateFormatMethod());
  ActivitiRequest ar=new ActivitiRequest(req);
  try {
    getIdentityService().setAuthenticatedUserId(ar.getCurrentUserId());
    executeWebScript(ar,status,cache,model);
  }
 catch (  Exception e) {
    String failure=ar.getString("failure",null);
    if (failure == null) {
      failure=ar.getBody().getString("failure");
    }
    if (failure != null) {
      model.put("failure",failure);
      model.put("error",e.getMessage());
    }
 else     if (e instanceof WebScriptException) {
      throw (WebScriptException)e;
    }
 else {
      throw new WebScriptException(Status.STATUS_INTERNAL_SERVER_ERROR,e.getMessage(),e);
    }
  }
 finally {
    getIdentityService().setAuthenticatedUserId(null);
  }
  return model;
}
