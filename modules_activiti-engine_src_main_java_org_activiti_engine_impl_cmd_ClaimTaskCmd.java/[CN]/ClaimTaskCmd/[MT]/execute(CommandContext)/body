{
  if (taskId == null) {
    throw new ActivitiException("taskId is null");
  }
  TaskEntity task=Context.getCommandContext().getTaskManager().findTaskById(taskId);
  if (task == null) {
    throw new ActivitiException("Cannot find task with id " + taskId);
  }
  if (userId != null) {
    if (task.getAssignee() != null) {
      if (!task.getAssignee().equals(userId)) {
        throw new ActivitiException("Task " + taskId + " is already claimed by someone else");
      }
    }
 else {
      task.setAssignee(userId);
    }
  }
 else {
    task.setAssignee(null);
  }
  return null;
}
