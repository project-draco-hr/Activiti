{
  if (dbFactories.get(processEngineName) == null) {
synchronized (dbFactories) {
      if (dbFactories.get(processEngineName) == null) {
        ProcessEngineConfigurationImpl processEngineConfiguration=(ProcessEngineConfigurationImpl)getProcessEngineConfiguration();
        DataSource dataSource=processEngineConfiguration.getDataSource();
        TransactionFactory transactionFactory=processEngineConfiguration.getTransactionFactory();
        SqlSessionFactory sqlSessionFactory=createSessionFactory(dataSource,transactionFactory);
        CycleDbSqlSessionFactory factory=new CycleDbSqlSessionFactory();
        factory.setDatabaseType(processEngineConfiguration.getDatabaseType());
        factory.setIdGenerator(processEngineConfiguration.getIdGenerator());
        factory.setSqlSessionFactory(sqlSessionFactory);
        performDbSchemaCreation(factory,processEngineConfiguration);
        dbFactories.put(processEngineName,factory);
      }
    }
  }
  return dbFactories.get(processEngineName).getSqlSessionFactory();
}
