{
  if (!isOptimizeDeleteOperationsEnabled || deleteOperations.size() <= 1) {
    return deleteOperations;
  }
  List<DeleteOperation> optimizedDeleteOperations=new ArrayList<DbSqlSession.DeleteOperation>();
  boolean[] checkedIndices=new boolean[deleteOperations.size()];
  for (int i=0; i < deleteOperations.size(); i++) {
    if (checkedIndices[i] == true) {
      continue;
    }
    DeleteOperation deleteOperation=deleteOperations.get(i);
    boolean couldOptimize=false;
    if (deleteOperation instanceof CheckedDeleteOperation) {
      PersistentObject persistentObject=((CheckedDeleteOperation)deleteOperation).getPersistentObject();
      if (persistentObject instanceof BulkDeleteable) {
        String bulkDeleteStatement=dbSqlSessionFactory.getBulkDeleteStatement(persistentObject.getClass());
        bulkDeleteStatement=dbSqlSessionFactory.mapStatement(bulkDeleteStatement);
        if (bulkDeleteStatement != null) {
          BulkCheckedDeleteOperation bulkCheckedDeleteOperation=null;
          for (int j=0; j < deleteOperations.size(); j++) {
            DeleteOperation otherDeleteOperation=deleteOperations.get(j);
            if (j != i && checkedIndices[j] == false && otherDeleteOperation instanceof CheckedDeleteOperation) {
              PersistentObject otherPersistentObject=((CheckedDeleteOperation)otherDeleteOperation).getPersistentObject();
              if (otherPersistentObject.getClass().equals(persistentObject.getClass())) {
                if (bulkCheckedDeleteOperation == null) {
                  bulkCheckedDeleteOperation=new BulkCheckedDeleteOperation(persistentObject.getClass());
                  bulkCheckedDeleteOperation.addPersistentObject(persistentObject);
                  optimizedDeleteOperations.add(bulkCheckedDeleteOperation);
                }
                couldOptimize=true;
                bulkCheckedDeleteOperation.addPersistentObject(otherPersistentObject);
                checkedIndices[j]=true;
              }
 else {
                break;
              }
            }
          }
        }
      }
    }
    if (!couldOptimize) {
      optimizedDeleteOperations.add(deleteOperation);
    }
    checkedIndices[i]=true;
  }
  return optimizedDeleteOperations;
}
