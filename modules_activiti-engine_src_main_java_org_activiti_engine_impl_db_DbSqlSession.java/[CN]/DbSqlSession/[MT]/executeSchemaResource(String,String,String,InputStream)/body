{
  String sqlStatement=null;
  String exceptionSqlStatement=null;
  try {
    Connection connection=sqlSession.getConnection();
    Exception exception=null;
    byte[] bytes=IoUtil.readInputStream(inputStream,resourceName);
    String ddlStatements=new String(bytes);
    StringTokenizer tokenizer=new StringTokenizer(ddlStatements,";");
    while (tokenizer.hasMoreTokens()) {
      sqlStatement=tokenizer.nextToken().trim();
      if (sqlStatement.startsWith("# ")) {
        log.fine(sqlStatement.substring(2));
      }
 else       if (sqlStatement.startsWith("-- ")) {
        log.fine(sqlStatement.substring(3));
      }
 else       if (sqlStatement.startsWith("execute java ")) {
        String upgradestepClassName=sqlStatement.substring(13).trim();
        DbUpgradeStep dbUpgradeStep=null;
        try {
          dbUpgradeStep=(DbUpgradeStep)ReflectUtil.instantiate(upgradestepClassName);
        }
 catch (        ActivitiException e) {
          throw new ActivitiException("database update java class '" + upgradestepClassName + "' can't be instantiated: "+ e.getMessage(),e);
        }
        try {
          dbUpgradeStep.execute(this);
        }
 catch (        Exception e) {
          throw new ActivitiException("error while executing database update java class '" + upgradestepClassName + "': "+ e.getMessage(),e);
        }
      }
 else       if (!"".equals(sqlStatement)) {
        Statement jdbcStatement=connection.createStatement();
        try {
          log.fine("executing: " + sqlStatement);
          jdbcStatement.execute(sqlStatement);
          jdbcStatement.close();
        }
 catch (        Exception e) {
          if (exception == null) {
            exception=e;
            exceptionSqlStatement=sqlStatement;
          }
          log.log(Level.SEVERE,"problem during schema " + operation + ", statement '"+ sqlStatement,e);
        }
      }
    }
    if (exception != null) {
      throw exception;
    }
    log.fine("activiti db schema " + operation + " for component "+ component+ " successful");
  }
 catch (  Exception e) {
    throw new ActivitiException("couldn't " + operation + " db schema: "+ exceptionSqlStatement,e);
  }
}
