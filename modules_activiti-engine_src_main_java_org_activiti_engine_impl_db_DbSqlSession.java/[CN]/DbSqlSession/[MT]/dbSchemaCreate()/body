{
  ProcessEngineConfigurationImpl processEngineConfiguration=Context.getProcessEngineConfiguration();
  if (isEngineTablePresent()) {
    String dbVersion=getDbVersion();
    if (!ProcessEngine.VERSION.equals(dbVersion)) {
      throw new ActivitiWrongDbException(ProcessEngine.VERSION,dbVersion);
    }
  }
 else {
    dbSchemaCreateEngine();
  }
  if (processEngineConfiguration.getHistoryLevel() != HistoryLevel.NONE) {
    dbSchemaCreateHistory();
  }
  if (processEngineConfiguration.isDbIdentityUsed()) {
    dbSchemaCreateIdentity();
  }
}
