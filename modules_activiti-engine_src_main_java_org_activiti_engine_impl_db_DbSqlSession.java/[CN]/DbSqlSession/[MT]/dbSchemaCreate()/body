{
  ProcessEngineConfigurationImpl processEngineConfiguration=Context.getProcessEngineConfiguration();
  int configuredHistoryLevel=processEngineConfiguration.getHistoryLevel();
  if ((!processEngineConfiguration.isDbHistoryUsed()) && (configuredHistoryLevel > ProcessEngineConfigurationImpl.HISTORYLEVEL_NONE)) {
    throw new ActivitiException("historyLevel config is higher then 'none' and dbHistoryUsed is set to false");
  }
  if (isEngineTablePresent()) {
    String dbVersion=getDbVersion();
    if (!ProcessEngine.VERSION.equals(dbVersion)) {
      throw new ActivitiWrongDbException(ProcessEngine.VERSION,dbVersion);
    }
  }
 else {
    dbSchemaCreateEngine();
  }
  if (processEngineConfiguration.isDbHistoryUsed()) {
    dbSchemaCreateHistory();
  }
  if (processEngineConfiguration.isDbIdentityUsed()) {
    dbSchemaCreateIdentity();
  }
}
