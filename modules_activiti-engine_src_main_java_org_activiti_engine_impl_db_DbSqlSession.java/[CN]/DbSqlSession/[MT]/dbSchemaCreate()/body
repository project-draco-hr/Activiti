{
  ProcessEngineContext processEngineContext=Context.getProcessEngineContext();
  int configuredHistoryLevel=processEngineContext.getHistoryLevel();
  if ((!processEngineContext.isDbHistoryUsed()) && (configuredHistoryLevel > ProcessEngineConfigurationImpl.HISTORYLEVEL_NONE)) {
    throw new ActivitiException("historyLevel config is higher then 'none' and dbHistoryUsed is set to false");
  }
  if (isEngineTablePresent()) {
    String dbVersion=getDbVersion();
    if (!ProcessEngine.VERSION.equals(dbVersion)) {
      throw new ActivitiWrongDbException(ProcessEngine.VERSION,dbVersion);
    }
  }
 else {
    dbSchemaCreateEngine();
  }
  if (processEngineContext.isDbHistoryUsed()) {
    dbSchemaCreateHistory();
  }
  if (processEngineContext.isDbIdentityUsed()) {
    dbSchemaCreateIdentity();
  }
  if (processEngineContext.isDbCycleUsed()) {
    dbSchemaCreateCycle();
  }
}
