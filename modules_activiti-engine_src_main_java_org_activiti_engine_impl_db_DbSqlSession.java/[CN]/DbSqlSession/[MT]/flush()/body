{
  List<DeleteOperation> removedOperations=removeUnnecessaryOperations();
  flushDeserializedObjects();
  List<PersistentObject> updatedObjects=getUpdatedObjects();
  if (log.isDebugEnabled()) {
    log.debug("flush summary: {} insert, {} update, {} delete.",insertedObjects.size(),updatedObjects.size(),deleteOperations.size());
    for (    PersistentObject insertedObject : insertedObjects) {
      log.debug("  insert {}",insertedObject);
    }
    for (    PersistentObject updatedObject : updatedObjects) {
      log.debug("  update {}",updatedObject);
    }
    for (    DeleteOperation deleteOperation : deleteOperations) {
      log.debug("  {}",deleteOperation);
    }
    log.debug("now executing flush...");
  }
  flushInserts();
  flushUpdates(updatedObjects);
  flushDeletes(removedOperations);
}
