{
  if (sessionFactories == null) {
    sessionFactories=new HashMap<Class<?>,SessionFactory>();
    addSessionFactory(new DbRuntimeSessionFactory());
    addSessionFactory(new DbTaskSessionFactory());
    addSessionFactory(new DbIdentitySessionFactory());
    addSessionFactory(new DbManagementSessionFactory());
    addSessionFactory(new JobExecutorTimerSessionFactory());
    addSessionFactory(new DbHistorySessionFactory());
    DbRepositorySessionFactory dbRepositorySessionFactory=new DbRepositorySessionFactory();
    dbRepositorySessionFactory.setDeployers(deployers);
    addSessionFactory(dbRepositorySessionFactory);
    JobExecutorMessageSessionFactory jobExecutorMessageSessionFactory=new JobExecutorMessageSessionFactory();
    addSessionFactory(jobExecutorMessageSessionFactory);
    dbSqlSessionFactory=new DbSqlSessionFactory();
    dbSqlSessionFactory.setDatabaseType(databaseType);
    dbSqlSessionFactory.setIdGenerator(idGenerator);
    dbSqlSessionFactory.setSqlSessionFactory(sqlSessionFactory);
    dbSqlSessionFactory.setDbEngineUsed(isDbEngineUsed);
    dbSqlSessionFactory.setDbIdentityUsed(isDbIdentityUsed);
    dbSqlSessionFactory.setDbHistoryUsed(isDbHistoryUsed);
    dbSqlSessionFactory.setDbCycleUsed(isDbCycleUsed);
    addSessionFactory(dbSqlSessionFactory);
  }
  if (customSessionFactories != null) {
    for (    SessionFactory sessionFactory : customSessionFactories) {
      addSessionFactory(sessionFactory);
    }
  }
}
