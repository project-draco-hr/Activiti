{
  Exchange ex=new DefaultExchange(getContext(springConfiguration,camelContext));
  ex.setProperty(ActivitiProducer.PROCESS_ID_PROPERTY,activityExecution.getProcessInstanceId());
  Map<String,Object> variables=activityExecution.getVariables();
  if (endpoint.isCopyVariablesToProperties()) {
    for (    Map.Entry<String,Object> var : variables.entrySet()) {
      ex.setProperty(var.getKey(),var.getValue());
    }
  }
  if (endpoint.isCopyVariablesToBody()) {
    ex.getIn().setBody(new HashMap<String,Object>(variables));
  }
  return ex;
}
