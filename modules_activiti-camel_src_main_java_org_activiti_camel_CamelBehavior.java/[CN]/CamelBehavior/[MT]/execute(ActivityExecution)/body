{
  ProcessEngineConfiguration engineConfiguration=Context.getProcessEngineConfiguration();
  if (engineConfiguration instanceof SpringProcessEngineConfiguration == false) {
    throw new ActivitiException("Expecting a Spring process engine configuration for the Activiti Camel module");
  }
  SpringProcessEngineConfiguration springConfiguration=(SpringProcessEngineConfiguration)engineConfiguration;
  String camelContextValue=this.getStringFromField(this.camelContext,execution);
  if (StringUtils.isEmpty(camelContextValue)) {
    camelContextValue=springConfiguration.getDefaultCamelContext();
  }
  ActivitiEndpoint endpoint=createEndpoint(execution,springConfiguration,camelContextValue);
  Exchange exchange=createExchange(execution,endpoint,springConfiguration,camelContextValue);
  endpoint.process(exchange);
  execution.setVariables(ExchangeUtils.prepareVariables(exchange,endpoint));
  performDefaultOutgoingBehavior(execution);
}
