{
  String artifactId=req.getString("artifactId");
  String cuid=req.getCurrentUserId();
  WebScriptRequest wsReq=req.getWebScriptRequest();
  HttpSession session=req.getHttpSession();
  RepositoryConnector conn=SessionUtil.getRepositoryConnector(cuid,session);
  RepositoryArtifact artifact=conn.getRepositoryArtifact(artifactId);
  List<String> contentRepresentations=new ArrayList<String>();
  for (  ContentRepresentation representation : artifact.getArtifactType().getContentRepresentations()) {
    contentRepresentations.add(representation.getId());
  }
  model.put("contentRepresentations",contentRepresentations);
  model.put("actions",artifact.getArtifactType().getParameterizedActions());
  List<DownloadActionView> downloads=new ArrayList<DownloadActionView>();
  for (  DownloadContentAction action : artifact.getArtifactType().getDownloadContentActions()) {
    try {
      String url=wsReq.getServerPath() + wsReq.getContextPath() + "/service/content?artifactId="+ URLEncoder.encode(artifactId,"UTF-8")+ "&content-type="+ URLEncoder.encode(action.getContentRepresentation().getMimeType(),"UTF-8");
      downloads.add(new DownloadActionView(action.getId(),url,action.getContentRepresentation().getMimeType(),action.getContentRepresentation().getId()));
    }
 catch (    UnsupportedEncodingException e) {
      throw new RuntimeException(e);
    }
  }
  model.put("downloads",downloads);
  model.put("links",artifact.getOutgoingLinks());
  model.put("artifactId",artifact.getId());
}
