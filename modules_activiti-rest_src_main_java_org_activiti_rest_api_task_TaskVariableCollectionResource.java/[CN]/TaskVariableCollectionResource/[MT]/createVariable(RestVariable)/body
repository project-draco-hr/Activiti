{
  if (authenticate() == false)   return null;
  if (restVariable.getName() == null) {
    throw new ActivitiIllegalArgumentException("Variable name is required");
  }
  String taskId=getAttribute("taskId");
  if (taskId == null) {
    throw new ActivitiIllegalArgumentException("TaskId is required");
  }
  RestVariableScope scope=restVariable.getVariableScope();
  if (scope == null) {
    scope=RestVariableScope.LOCAL;
  }
  if (hasVariableOnScope(taskId,restVariable.getName(),scope)) {
    throw new ResourceException(new Status(Status.CLIENT_ERROR_CONFLICT.getCode(),"Variable '" + restVariable.getName() + "' is already present on task '"+ taskId+ "'.",null,null));
  }
  Object actualVariableValue=getApplication(ActivitiRestServicesApplication.class).getRestResponseFactory().getVariableValue(restVariable);
  if (scope == RestVariableScope.LOCAL) {
    ActivitiUtil.getTaskService().setVariableLocal(taskId,restVariable.getName(),actualVariableValue);
  }
 else {
    Task task=ActivitiUtil.getTaskService().createTaskQuery().taskId(taskId).singleResult();
    if (task.getExecutionId() != null) {
      ActivitiUtil.getRuntimeService().setVariable(task.getExecutionId(),restVariable.getName(),actualVariableValue);
    }
 else {
      throw new ActivitiIllegalArgumentException("Cannot set global variable '" + restVariable.getName() + "' on task '"+ taskId+ "', task is not part of process.");
    }
  }
  setStatus(Status.SUCCESS_CREATED);
  return getApplication(ActivitiRestServicesApplication.class).getRestResponseFactory().createRestVariable(this,restVariable.getName(),actualVariableValue,scope,taskId,null,false);
}
