{
  TaskEntity task=commandContext.getTaskSession().findTaskById(taskId);
  if (task != null) {
    task.delete(TaskEntity.DELETE_REASON_DELETED);
  }
  if (cascade) {
    int historyLevel=Context.getProcessEngineConfiguration().getHistoryLevel();
    DbSqlSession dbSqlSession=commandContext.getDbSqlSession();
    if (historyLevel >= ProcessEngineConfigurationImpl.HISTORYLEVEL_AUDIT) {
      dbSqlSession.delete(HistoricTaskInstanceEntity.class,taskId);
      List<HistoricDetail> historicTaskDetails=new HistoricDetailQueryImpl(commandContext).taskId(taskId).list();
      for (      HistoricDetail historicTaskDetail : historicTaskDetails) {
        dbSqlSession.delete(HistoricDetailEntity.class,historicTaskDetail.getId());
      }
    }
    if (historyLevel >= ProcessEngineConfigurationImpl.HISTORYLEVEL_ACTIVITY) {
      dbSqlSession.delete("deleteCommentsByTaskId",taskId);
      List<AttachmentEntity> attachments=dbSqlSession.selectList("selectAttachmentsByTaskId",taskId);
      for (      AttachmentEntity attachment : attachments) {
        String contentId=attachment.getContentId();
        if (contentId != null) {
          dbSqlSession.delete(ByteArrayEntity.class,contentId);
        }
        dbSqlSession.delete(AttachmentEntity.class,attachment.getId());
      }
    }
  }
}
