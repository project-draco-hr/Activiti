{
  try {
    DeploymentBuilder deploymentBuilder=repositoryService.createDeployment();
    String fileName=file.getName();
    if (fileName.endsWith(".bpmn20.xml") || fileName.endsWith(".bpmn")) {
      deploymentBuilder.addInputStream(fileName,file.getInputStream());
    }
 else     if (fileName.toLowerCase().endsWith(".bar") || fileName.toLowerCase().endsWith(".zip")) {
      deploymentBuilder.addZipInputStream(new ZipInputStream(file.getInputStream()));
    }
 else {
      throw new ActivitiIllegalArgumentException("File must be of type .bpmn20.xml, .bpmn, .bar or .zip");
    }
    deploymentBuilder.name(fileName);
    if (tenantId != null) {
      deploymentBuilder.tenantId(tenantId);
    }
    Deployment deployment=deploymentBuilder.deploy();
    response.setStatus(HttpStatus.SC_CREATED);
    return restResponseFactory.createDeploymentResponse(deployment,request.getRequestURL().toString().replace("/repository/deployments",""));
  }
 catch (  Exception e) {
    if (e instanceof ActivitiException) {
      throw (ActivitiException)e;
    }
    throw new ActivitiException(e.getMessage(),e);
  }
}
