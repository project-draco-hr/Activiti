{
  Properties environmentProperties=null;
  try {
    environmentProperties=loadProperties("environment.properties");
  }
 catch (  RuntimeException e) {
    logger.info("Could not load 'environment.properties' file, falling back to default environment properties.");
    environmentProperties=new Properties();
  }
  String environmentClassName=(String)environmentProperties.get("cycle.test.environment.class");
  if (environmentClassName == null) {
    environmentClassName=defaultTestEnvironmentClass.getName();
    logger.info("No cycle.test.environment.class specified, falling back to default environment: '" + environmentClassName + "'.");
  }
  try {
    Class<T> environmentClass=(Class<T>)CdiPluginTestCase.class.getClassLoader().loadClass(environmentClassName);
    T testEnvironment=(T)environmentClass.newInstance();
    return testEnvironment;
  }
 catch (  ClassNotFoundException e) {
    throw new ActivitiException("Could not find specified cycle test environment class: " + e.getMessage(),e);
  }
catch (  Exception e) {
    throw new ActivitiException("Error while setting up cycle test enviroment: " + e.getMessage(),e);
  }
}
