{
  ActivitiRequestObject body=req.getBody();
  FormData.FormField file=((WebScriptServletRequest)req.getWebScriptRequest()).getFileField("deployment");
  DeploymentBuilder deploymentBuilder=getRepositoryService().createDeployment();
  String fileName=file.getFilename();
  if (fileName.endsWith(".bpmn20.xml")) {
    deploymentBuilder.addInputStream(fileName,file.getInputStream());
  }
 else   if (fileName.endsWith(".bar") || fileName.endsWith(".zip")) {
    deploymentBuilder.addZipInputStream(new ZipInputStream(file.getInputStream()));
  }
 else {
    throw new WebScriptException(Status.STATUS_BAD_REQUEST,"File must be of type .bpmn20.xml, .bar or .zip");
  }
  deploymentBuilder.name(fileName);
  deploymentBuilder.deploy();
  String success=req.getBody().getString("success");
  if (success != null) {
    model.put("success",success);
  }
}
