{
  try {
    this.databaseName=databaseName;
    initializeDatabaseStatements(databaseName);
    ClassLoader classLoader=Thread.currentThread().getContextClassLoader();
    InputStream inputStream=classLoader.getResourceAsStream("org/activiti/db/ibatis/activiti.ibatis.mem.conf.xml");
    Reader reader=new InputStreamReader(inputStream);
    sqlSessionFactory=new SqlSessionFactoryBuilder().build(reader);
    PooledDataSource dataSource=new PooledDataSource(classLoader,jdbcDriver,jdbcUrl,jdbcUsername,jdbcPassword);
    dataSource.forceCloseAll();
    Environment environment=new Environment("default",new JdbcTransactionFactory(),dataSource);
    sqlSessionFactory.getConfiguration().setEnvironment(environment);
  }
 catch (  Exception e) {
    throw new ActivitiException("Error while building ibatis SqlSessionFactory: " + e.getMessage(),e);
  }
}
