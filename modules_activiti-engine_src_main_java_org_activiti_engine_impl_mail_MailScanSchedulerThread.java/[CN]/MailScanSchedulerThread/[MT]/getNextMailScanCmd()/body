{
  MailScanCmd nextMailScanCmd=null;
  while (nextMailScanCmd == null) {
    while (allMailScansCmds.isEmpty() && nextMailScanCmds.isEmpty()) {
      try {
        log.fine("sleeping for " + idleWaitInMillis + " millis");
        Thread.sleep(idleWaitInMillis);
      }
 catch (      InterruptedException e) {
        log.fine("sleep got interrupted");
        return null;
      }
    }
    if (nextMailScanCmds.isEmpty()) {
      log.fine("scheduling mailscans for users " + allMailScansCmds.keySet());
      nextMailScanCmds.addAll(allMailScansCmds.values());
    }
synchronized (this) {
      if (!nextMailScanCmds.isEmpty()) {
        nextMailScanCmd=nextMailScanCmds.remove(0);
      }
    }
  }
  return nextMailScanCmd;
}
