{
  HistoricProcessInstanceEntity historicProcessInstance=CommandContext.getCurrent().getHistorySession().findHistoricProcessInstance(execution.getProcessInstanceId());
  if (historicProcessInstance != null) {
    String deleteReason=((ExecutionEntity)execution).getDeleteReason();
    historicProcessInstance.markEnded(deleteReason);
    historicProcessInstance.setEndActivityId(((ExecutionEntity)execution).getActivityId());
  }
}
