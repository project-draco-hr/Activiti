{
  User savedUser=null;
  try {
    User newUser=identityService.newUser("testuser");
    newUser.setFirstName("Fred");
    newUser.setLastName("McDonald");
    newUser.setEmail("no-reply@activiti.org");
    identityService.saveUser(newUser);
    savedUser=newUser;
    ClientResource client=getAuthenticatedClient(RestUrls.createRelativeResourceUrl(RestUrls.URL_USER,newUser.getId()));
    Representation response=client.delete();
    assertEquals(Status.SUCCESS_NO_CONTENT,client.getResponse().getStatus());
    assertEquals(0L,response.getSize());
    assertEquals(0,identityService.createUserQuery().userId(newUser.getId()).count());
    savedUser=null;
  }
  finally {
    if (savedUser != null) {
      identityService.deleteUser(savedUser.getId());
    }
  }
}
