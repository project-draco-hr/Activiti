{
  VariableTypes variableTypes=Context.getProcessEngineConfiguration().getVariableTypes();
  VariableType type=variableTypes.findVariableType(value);
  VariableInstanceEntity variableInstance=VariableInstanceEntity.createAndInsert(variableName,type,value);
  initializeVariableInstanceBackPointer(variableInstance);
  variableInstances.put(variableName,variableInstance);
  variableInstance.setValue(value);
  int historyLevel=Context.getProcessEngineConfiguration().getHistoryLevel();
  if (historyLevel == ProcessEngineConfigurationImpl.HISTORYLEVEL_FULL) {
    insertHistoricDetailVariableInstanceUpdate(variableInstance,sourceActivityExecution);
  }
  if (historyLevel >= ProcessEngineConfigurationImpl.HISTORYLEVEL_AUDIT) {
    insertHistoricVariableInstance(variableInstance);
  }
  return variableInstance;
}
