{
  RestletFileUpload upload=new RestletFileUpload(new DiskFileItemFactory());
  List<FileItem> items=upload.parseRepresentation(representation);
  String name=null;
  String description=null;
  String type=null;
  FileItem uploadItem=null;
  for (  FileItem fileItem : items) {
    if (fileItem.isFormField()) {
      if ("name".equals(fileItem.getFieldName())) {
        name=fileItem.getString("UTF-8");
      }
 else       if ("description".equals(fileItem.getFieldName())) {
        description=fileItem.getString("UTF-8");
      }
 else       if ("type".equals(fileItem.getFieldName())) {
        type=fileItem.getString("UTF-8");
      }
    }
 else     if (fileItem.getName() != null) {
      uploadItem=fileItem;
    }
  }
  if (name == null) {
    throw new ActivitiIllegalArgumentException("Attachment name is required.");
  }
  if (uploadItem == null) {
    throw new ActivitiIllegalArgumentException("Attachment content is required.");
  }
  Attachment createdAttachment=ActivitiUtil.getTaskService().createAttachment(type,task.getId(),null,name,description,uploadItem.getInputStream());
  setStatus(Status.SUCCESS_CREATED);
  return getApplication(ActivitiRestServicesApplication.class).getRestResponseFactory().createAttachmentResponse(this,createdAttachment);
}
