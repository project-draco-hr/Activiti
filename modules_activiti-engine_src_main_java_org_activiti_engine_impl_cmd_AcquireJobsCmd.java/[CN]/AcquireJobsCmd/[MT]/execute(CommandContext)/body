{
  String lockOwner=jobExecutor.getLockOwner();
  int lockTimeInMillis=jobExecutor.getLockTimeInMillis();
  int maxJobsPerAcquisition=jobExecutor.getMaxJobsPerAcquisition();
  int jobsInThisAcquisition=0;
  AcquiredJobs acquiredJobs=new AcquiredJobs();
  List<JobEntity> jobs=commandContext.getJobManager().findNextJobsToExecute(new Page(0,maxJobsPerAcquisition));
  for (  JobEntity job : jobs) {
    List<String> jobIds=new ArrayList<String>();
    if (job != null && !acquiredJobs.contains(job.getId())) {
      if (job.isExclusive() && job.getProcessInstanceId() != null) {
        List<JobEntity> exclusiveJobs=commandContext.getJobManager().findExclusiveJobsToExecute(job.getProcessInstanceId());
        for (        JobEntity exclusiveJob : exclusiveJobs) {
          if (exclusiveJob != null) {
            lockJob(exclusiveJob,lockOwner,lockTimeInMillis);
            jobIds.add(exclusiveJob.getId());
          }
        }
      }
 else {
        lockJob(job,lockOwner,lockTimeInMillis);
        jobIds.add(job.getId());
      }
    }
    acquiredJobs.addJobIdBatch(jobIds);
    jobsInThisAcquisition+=jobIds.size();
    if (jobsInThisAcquisition >= maxJobsPerAcquisition) {
      break;
    }
  }
  return acquiredJobs;
}
