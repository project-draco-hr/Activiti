{
  String lockOwner=jobExecutor.getLockOwner();
  int lockTimeInMillis=jobExecutor.getLockTimeInMillis();
  int maxNonExclusiveJobsPerAcquisition=jobExecutor.getMaxJobsPerAcquisition();
  AcquiredJobs acquiredJobs=new AcquiredJobs();
  List<JobEntity> jobs=commandContext.getJobManager().findNextJobsToExecute(new Page(0,maxNonExclusiveJobsPerAcquisition));
  for (  JobEntity job : jobs) {
    List<String> jobIds=new ArrayList<String>();
    if (job != null && !acquiredJobs.contains(job.getId())) {
      if (job.isExclusive() && job.getProcessInstanceId() != null) {
        List<JobEntity> exclusiveJobs=commandContext.getJobManager().findExclusiveJobsToExecute(job.getProcessInstanceId());
        for (        JobEntity exclusiveJob : exclusiveJobs) {
          if (exclusiveJob != null) {
            lockJob(exclusiveJob,lockOwner,lockTimeInMillis);
            jobIds.add(exclusiveJob.getId());
          }
        }
      }
 else {
        lockJob(job,lockOwner,lockTimeInMillis);
        jobIds.add(job.getId());
      }
    }
    acquiredJobs.addJobIdBatch(jobIds);
  }
  return acquiredJobs;
}
