{
  try {
    if (authenticate(SecuredResource.ADMIN) == false)     return null;
    RestletFileUpload upload=new RestletFileUpload(new DiskFileItemFactory());
    List<FileItem> items=upload.parseRepresentation(entity);
    FileItem uploadItem=null;
    for (    FileItem fileItem : items) {
      if (fileItem.getName() != null) {
        uploadItem=fileItem;
      }
    }
    DeploymentBuilder deploymentBuilder=ActivitiUtil.getRepositoryService().createDeployment();
    String fileName=uploadItem.getName();
    if (fileName.endsWith(".bpmn20.xml")) {
      deploymentBuilder.addInputStream(fileName,uploadItem.getInputStream());
    }
 else     if (fileName.toLowerCase().endsWith(".bar") || fileName.toLowerCase().endsWith(".zip")) {
      deploymentBuilder.addZipInputStream(new ZipInputStream(uploadItem.getInputStream()));
    }
 else {
      throw new ActivitiException("File must be of type .bpmn20.xml, .bar or .zip");
    }
    deploymentBuilder.name(fileName);
    Deployment deployment=deploymentBuilder.deploy();
    return new DeploymentResponse(deployment);
  }
 catch (  Exception e) {
    throw new ActivitiException(e.getMessage(),e);
  }
}
