{
  this.app=application;
  setWriteThrough(false);
  setImmediate(true);
  setSizeFull();
  HorizontalLayout footer=new HorizontalLayout();
  footer.setSpacing(true);
  footer.setWidth("100%");
  footer.setVisible(true);
  setFooter(footer);
  save=new Button(app.getMessage(Messages.Save),(ClickListener)this);
  close=new Button(app.getMessage(Messages.Close),(ClickListener)this);
  reset=new Button(app.getMessage(Messages.Reset),this,"discard");
  GridLayout grid=new GridLayout(3,1);
  grid.addComponent(save,0,0);
  grid.addComponent(reset,1,0);
  grid.addComponent(close,2,0);
  grid.setSpacing(true);
  footer.addComponent(grid);
  footer.setComponentAlignment(grid,Alignment.BOTTOM_RIGHT);
  groups=new TwinColSelect(app.getMessage(Messages.Groups),app.getAdminService().getGroups());
  groups.setLeftColumnCaption(app.getMessage(Messages.AvailableGroups));
  groups.setRightColumnCaption(app.getMessage(Messages.MemberOfGroups));
  groups.setImmediate(true);
  groups.setWidth("100%");
  setFormFieldFactory(new DefaultFieldFactory(){
    private static final long serialVersionUID=1L;
    @Override public Field createField(    Item item,    Object propertyId,    Component uiContext){
      Field field=super.createField(item,propertyId,uiContext);
      if (propertyId.equals("id")) {
        TextField tf=(TextField)field;
        tf.setNullRepresentation("");
        tf.setReadOnly(true);
        tf.setRequiredError(app.getMessage(Messages.UsernameIsMissing));
      }
 else       if (propertyId.equals("password")) {
        TextField tf=(TextField)field;
        tf.setNullRepresentation("");
        tf.setRequired(true);
        tf.setSecret(true);
        tf.setRequiredError(app.getMessage(Messages.PasswordIsMissing));
      }
 else       if (propertyId.equals("email")) {
        TextField tf=(TextField)field;
        tf.setNullRepresentation("");
        field.addValidator(new EmailValidator(app.getMessage(Messages.EmailFormatError)));
      }
 else       if (propertyId.equals("firstName")) {
        TextField tf=(TextField)field;
        tf.setNullRepresentation("");
      }
 else       if (propertyId.equals("lastName")) {
        TextField tf=(TextField)field;
        tf.setNullRepresentation("");
      }
      field.setWidth("100%");
      return field;
    }
  }
);
}
