{
  ProcessService processService=deployer.getProcessService();
  TaskService taskService=deployer.getTaskService();
  Deployment deployment=processService.createDeployment().addClasspathResource("org/activiti/examples/bpmn/subprocess/SubProcessTest.fixSystemFailureProcess.bpmn20.xml").deploy();
  ProcessInstance pi=deployer.getProcessService().startProcessInstanceByKey("fixSystemFailure");
  List<Task> tasks=taskService.createTaskQuery().processInstance(pi.getId()).orderAsc(TaskQuery.PROPERTY_NAME).list();
  Task investigateHardwareTask=tasks.get(0);
  Task investigateSoftwareTask=tasks.get(1);
  assertEquals("Investigate hardware",investigateHardwareTask.getName());
  assertEquals("Investigate software",investigateSoftwareTask.getName());
  taskService.complete(investigateHardwareTask.getId());
  taskService.complete(investigateSoftwareTask.getId());
  Task writeReportTask=taskService.createTaskQuery().processInstance(pi.getId()).singleResult();
  assertEquals("Write report",writeReportTask.getName());
  processService.deleteDeploymentCascade(deployment.getId());
}
