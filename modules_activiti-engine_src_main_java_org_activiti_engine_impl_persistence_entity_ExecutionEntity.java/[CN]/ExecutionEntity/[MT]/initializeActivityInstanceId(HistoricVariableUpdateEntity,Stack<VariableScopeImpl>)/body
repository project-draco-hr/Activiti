{
  int historyLevel=Context.getProcessEngineConfiguration().getHistoryLevel();
  if (historyLevel >= ProcessEngineConfigurationImpl.HISTORYLEVEL_FULL) {
    for (    VariableScopeImpl scope : scopes) {
      if (scope instanceof ExecutionEntity) {
        HistoricActivityInstanceEntity historicActivityInstance=ActivityInstanceEndHandler.findActivityInstance((ExecutionEntity)scope);
        if (historicActivityInstance != null) {
          historicVariableUpdate.setActivityInstanceId(historicActivityInstance.getId());
        }
        break;
      }
    }
  }
}
