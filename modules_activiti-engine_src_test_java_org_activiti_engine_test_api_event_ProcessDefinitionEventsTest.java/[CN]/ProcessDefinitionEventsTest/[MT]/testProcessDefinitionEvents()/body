{
  ProcessDefinition processDefinition=repositoryService.createProcessDefinitionQuery().processDefinitionKey("oneTaskProcess").singleResult();
  assertNotNull(processDefinition);
  assertEquals(1,listener.getEventsReceived().size());
  assertTrue(listener.getEventsReceived().get(0) instanceof ActivityEntityEvent);
  ActivityEntityEvent event=(ActivityEntityEvent)listener.getEventsReceived().get(0);
  assertEquals(ActivitiEventType.ENTITY_CREATED,event.getType());
  assertEquals(processDefinition.getId(),((ProcessDefinition)event.getEntity()).getId());
  listener.clearEventsReceived();
  repositoryService.setProcessDefinitionCategory(processDefinition.getId(),"test");
  assertEquals(1,listener.getEventsReceived().size());
  assertTrue(listener.getEventsReceived().get(0) instanceof ActivityEntityEvent);
  event=(ActivityEntityEvent)listener.getEventsReceived().get(0);
  assertEquals(ActivitiEventType.ENTITY_UPDATED,event.getType());
  assertEquals(processDefinition.getId(),((ProcessDefinition)event.getEntity()).getId());
  assertEquals("test",((ProcessDefinition)event.getEntity()).getCategory());
  listener.clearEventsReceived();
  repositoryService.suspendProcessDefinitionById(processDefinition.getId());
  repositoryService.activateProcessDefinitionById(processDefinition.getId());
  assertEquals(2,listener.getEventsReceived().size());
  event=(ActivityEntityEvent)listener.getEventsReceived().get(0);
  assertEquals(processDefinition.getId(),((ProcessDefinition)event.getEntity()).getId());
  assertEquals(ActivitiEventType.ENTITY_SUSPENDED,event.getType());
  event=(ActivityEntityEvent)listener.getEventsReceived().get(1);
  assertEquals(ActivitiEventType.ENTITY_ACTIVATED,event.getType());
  assertEquals(processDefinition.getId(),((ProcessDefinition)event.getEntity()).getId());
  listener.clearEventsReceived();
  repositoryService.deleteDeployment(processDefinition.getDeploymentId(),true);
  deploymentId=null;
  assertEquals(1,listener.getEventsReceived().size());
  assertTrue(listener.getEventsReceived().get(0) instanceof ActivityEntityEvent);
  event=(ActivityEntityEvent)listener.getEventsReceived().get(0);
  assertEquals(ActivitiEventType.ENTITY_DELETED,event.getType());
  assertEquals(processDefinition.getId(),((ProcessDefinition)event.getEntity()).getId());
  listener.clearEventsReceived();
}
