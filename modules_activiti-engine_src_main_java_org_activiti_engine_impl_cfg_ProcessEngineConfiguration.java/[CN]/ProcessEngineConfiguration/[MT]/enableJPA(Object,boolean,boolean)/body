{
  if (entityManagerFactory == null) {
    throw new ActivitiException("entityManagerFactory is null, JPA cannot be enabled");
  }
  if (!sessionFactories.containsKey(EntityManagerSession.class)) {
    sessionFactories.put(EntityManagerSession.class,new EntityManagerSessionFactory(entityManagerFactory,true,true));
    Type jpaType=variableTypes.getVariableType(JPAEntityVariableType.TYPE_NAME);
    if (jpaType == null) {
      int serializableIndex=variableTypes.getTypeIndex(SerializableType.TYPE_NAME);
      if (serializableIndex > -1) {
        variableTypes.addType(new JPAEntityVariableType(),serializableIndex);
      }
 else {
        variableTypes.addType(new JPAEntityVariableType());
      }
    }
  }
 else {
    throw new ActivitiException("JPA is already enabled");
  }
}
