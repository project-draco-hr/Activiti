{
  Date duedate=timer.getDuedate();
  if (duedate == null) {
    throw new ActivitiException("duedate is null");
  }
  CommandContext commandContext=Context.getCommandContext();
  commandContext.getDbSqlSession().insert(timer);
  JobExecutor jobExecutor=Context.getProcessEngineConfiguration().getJobExecutor();
  int waitTimeInMillis=jobExecutor.getWaitTimeInMillis();
  if (duedate.getTime() < (ClockUtil.getCurrentTime().getTime() + waitTimeInMillis)) {
    commandContext.getTransactionContext().addTransactionListener(TransactionState.COMMITTED,new MessageAddedNotification());
  }
}
