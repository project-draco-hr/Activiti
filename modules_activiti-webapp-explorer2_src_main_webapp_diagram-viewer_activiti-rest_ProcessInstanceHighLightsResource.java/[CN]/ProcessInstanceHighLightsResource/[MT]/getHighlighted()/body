{
  if (authenticate() == false)   return null;
  String processInstanceId=(String)getRequest().getAttributes().get("processInstanceId");
  if (processInstanceId == null) {
    throw new ActivitiException("No process instance id provided");
  }
  ObjectNode responseJSON=new ObjectMapper().createObjectNode();
  responseJSON.put("processInstanceId",processInstanceId);
  ArrayNode activitiesArray=new ObjectMapper().createArrayNode();
  ArrayNode flowsArray=new ObjectMapper().createArrayNode();
  try {
    processInstance=runtimeService.createProcessInstanceQuery().processInstanceId(processInstanceId).singleResult();
    processDefinition=(ProcessDefinitionEntity)repositoryService.getDeployedProcessDefinition(processInstance.getProcessDefinitionId());
    responseJSON.put("processDefinitionId",processInstance.getProcessDefinitionId());
    List<String> highLightedActivities=runtimeService.getActiveActivityIds(processInstanceId);
    List<String> highLightedFlows=getHighLightedFlows(processDefinition,processInstanceId);
    for (    String activityId : highLightedActivities)     activitiesArray.add(activityId);
    for (    String flow : highLightedFlows)     flowsArray.add(flow);
    for (    String activityId : highLightedActivities) {
      Execution execution=runtimeService.createExecutionQuery().processInstanceId(processInstance.getProcessInstanceId()).activityId(activityId).singleResult();
      ExecutionEntity executionEntity=(ExecutionEntity)execution;
      executionEntity.getProcessDefinitionId();
    }
  }
 catch (  Exception e) {
  }
  responseJSON.put("activities",activitiesArray);
  responseJSON.put("flows",flowsArray);
  return responseJSON;
}
