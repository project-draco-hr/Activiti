{
  if (directory == null || !directory.exists()) {
    throw new ActivitiException("Provided directory does not exist");
  }
  if (!directory.isDirectory()) {
    throw new ActivitiException(directory.getAbsolutePath() + " is not a folder");
  }
  File processDefinitionFile=new File(directory.getAbsolutePath() + "/processdefinition.xml");
  if (processDefinitionFile.exists()) {
    if (LOGGER.isLoggable(Level.INFO)) {
      LOGGER.info("Process definition found in " + directory.getAbsolutePath());
    }
    JbpmContext context=Jbpm3Util.getJbpmConfiguration(JBPM_IN_MEM_CFG).createJbpmContext();
    try {
      Jbpm3Util.deployJbpmProcess(context,directory.getAbsolutePath());
    }
  finally {
      context.close();
    }
  }
 else {
    if (LOGGER.isLoggable(Level.INFO)) {
      LOGGER.info("No process definition found in " + directory.getAbsolutePath());
    }
  }
  File[] subDirectories=directory.listFiles(new FileFilter(){
    public boolean accept(    File pathname){
      return pathname.isDirectory();
    }
  }
);
  if (subDirectories.length > 0) {
    for (    File subDirectory : subDirectories) {
      searchAndDeployProcessesToInMemDatabase(subDirectory);
    }
  }
}
