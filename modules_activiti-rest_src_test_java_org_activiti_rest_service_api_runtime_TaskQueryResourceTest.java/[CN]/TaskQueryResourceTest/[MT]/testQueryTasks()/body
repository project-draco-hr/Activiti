{
  try {
    Calendar adhocTaskCreate=Calendar.getInstance();
    adhocTaskCreate.set(Calendar.MILLISECOND,0);
    Calendar processTaskCreate=Calendar.getInstance();
    processTaskCreate.add(Calendar.HOUR,2);
    processTaskCreate.set(Calendar.MILLISECOND,0);
    Calendar inBetweenTaskCreation=Calendar.getInstance();
    inBetweenTaskCreation.add(Calendar.HOUR,1);
    processEngineConfiguration.getClock().setCurrentTime(adhocTaskCreate.getTime());
    Task adhocTask=taskService.newTask();
    adhocTask.setAssignee("gonzo");
    adhocTask.setOwner("owner");
    adhocTask.setDelegationState(DelegationState.PENDING);
    adhocTask.setDescription("Description one");
    adhocTask.setName("Name one");
    adhocTask.setDueDate(adhocTaskCreate.getTime());
    adhocTask.setPriority(100);
    taskService.saveTask(adhocTask);
    taskService.addUserIdentityLink(adhocTask.getId(),"misspiggy",IdentityLinkType.PARTICIPANT);
    processEngineConfiguration.getClock().setCurrentTime(processTaskCreate.getTime());
    ProcessInstance processInstance=runtimeService.startProcessInstanceByKey("oneTaskProcess","myBusinessKey");
    Task processTask=taskService.createTaskQuery().processInstanceId(processInstance.getId()).singleResult();
    processTask.setParentTaskId(adhocTask.getId());
    processTask.setPriority(50);
    processTask.setDueDate(processTaskCreate.getTime());
    taskService.saveTask(processTask);
    String url=RestUrls.createRelativeResourceUrl(RestUrls.URL_TASK_QUERY);
    ObjectNode requestNode=objectMapper.createObjectNode();
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId(),adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("name","Name one");
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("nameLike","%one");
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("description","Description one");
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("descriptionLike","%one");
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("priority",100);
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("minimumPriority",70);
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("maximumPriority",70);
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("owner","owner");
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("assignee","gonzo");
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("ownerLike","owne%");
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("assigneeLike","%onzo");
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("unassigned",true);
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("delegationState","pending");
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("candidateUser","kermit");
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("candidateGroup","sales");
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    ArrayNode arrayNode=requestNode.arrayNode();
    arrayNode.add("sales");
    arrayNode.add("someOtherGroup");
    requestNode.put("candidateGroupIn",arrayNode);
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("involvedUser","misspiggy");
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("processInstanceId",processInstance.getId());
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("executionId",processInstance.getId());
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("processInstanceBusinessKey","myBusinessKey");
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("processInstanceBusinessKeyLike","myBusiness%");
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("processDefinitionKey","oneTaskProcess");
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("processDefinitionKeyLike","%TaskProcess");
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("processDefinitionName","The One Task Process");
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("processDefinitionNameLike","The One %");
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("createdOn",getISODateString(adhocTaskCreate.getTime()));
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("createdAfter",getISODateString(inBetweenTaskCreation.getTime()));
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("createdBefore",getISODateString(inBetweenTaskCreation.getTime()));
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("excludeSubTasks",true);
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("taskDefinitionKey","processTask");
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("taskDefinitionKeyLike","process%");
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("dueDate",getISODateString(adhocTaskCreate.getTime()));
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("dueAfter",getISODateString(inBetweenTaskCreation.getTime()));
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("dueBefore",getISODateString(inBetweenTaskCreation.getTime()));
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    runtimeService.suspendProcessInstanceById(processInstance.getId());
    requestNode.removeAll();
    requestNode.put("active",false);
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
    requestNode.removeAll();
    requestNode.put("active",true);
    assertResultsPresentInDataResponse(url,requestNode,adhocTask.getId());
    requestNode.removeAll();
    requestNode.put("withoutDueDate",true);
    assertResultsPresentInDataResponse(url,requestNode);
    processTask=taskService.createTaskQuery().processInstanceId(processInstance.getId()).singleResult();
    processTask.setDueDate(null);
    taskService.saveTask(processTask);
    assertResultsPresentInDataResponse(url,requestNode,processTask.getId());
  }
  finally {
    List<Task> tasks=taskService.createTaskQuery().list();
    for (    Task task : tasks) {
      if (task.getExecutionId() == null) {
        taskService.deleteTask(task.getId(),true);
      }
    }
  }
}
