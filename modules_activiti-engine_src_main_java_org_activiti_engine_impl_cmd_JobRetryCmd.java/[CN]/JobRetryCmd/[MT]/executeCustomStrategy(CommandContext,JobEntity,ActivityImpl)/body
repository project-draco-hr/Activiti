{
  String failedJobRetryTimeCycle=activity.getFailedJobRetryTimeCycleValue();
  if (failedJobRetryTimeCycle == null) {
    executeStandardStrategy(commandContext);
  }
 else {
    DurationHelper durationHelper=new DurationHelper(failedJobRetryTimeCycle,Context.getProcessEngineConfiguration().getClock());
    job.setLockExpirationTime(durationHelper.getDateAfter());
    if (job.getExceptionMessage() == null) {
      log.fine("Applying JobRetryStrategy '" + failedJobRetryTimeCycle + "' the first time for job "+ job.getId()+ " with "+ durationHelper.getTimes()+ " retries");
      job.setRetries(durationHelper.getTimes());
    }
 else {
      log.fine("Decrementing retries of JobRetryStrategy '" + failedJobRetryTimeCycle + "' for job "+ job.getId());
    }
    if (exception != null) {
      job.setExceptionMessage(exception.getMessage());
      job.setExceptionStacktrace(getExceptionStacktrace());
    }
    job.setRetries(job.getRetries() - 1);
    JobExecutor jobExecutor=Context.getProcessEngineConfiguration().getJobExecutor();
    MessageAddedNotification messageAddedNotification=new MessageAddedNotification(jobExecutor);
    TransactionContext transactionContext=commandContext.getTransactionContext();
    transactionContext.addTransactionListener(TransactionState.COMMITTED,messageAddedNotification);
  }
}
