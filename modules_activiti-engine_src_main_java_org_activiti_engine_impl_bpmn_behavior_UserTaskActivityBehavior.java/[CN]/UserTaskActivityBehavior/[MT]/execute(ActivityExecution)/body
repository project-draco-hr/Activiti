{
  TaskEntity task=TaskEntity.createAndInsert(execution);
  task.setExecution(execution);
  task.setTaskDefinition(taskDefinition);
  if (taskDefinition.getNameExpression() != null) {
    String name=(String)taskDefinition.getNameExpression().getValue(execution);
    task.setName(name);
  }
  if (taskDefinition.getDescriptionExpression() != null) {
    String description=(String)taskDefinition.getDescriptionExpression().getValue(execution);
    task.setDescription(description);
  }
  if (taskDefinition.getDueDateExpression() != null) {
    Object dueDate=taskDefinition.getDueDateExpression().getValue(execution);
    if (dueDate != null) {
      if (!(dueDate instanceof Date)) {
        throw new ActivitiException("Due date expression does not resolve to a Date: " + taskDefinition.getDueDateExpression().getExpressionText());
      }
      task.setDueDate((Date)dueDate);
    }
  }
  handleAssignments(task,execution);
  task.fireEvent(TaskListener.EVENTNAME_CREATE);
}
