{
  try {
    if (authenticate() == false)     return null;
    if (entity == null || entity.getMediaType() == null || !MediaType.MULTIPART_FORM_DATA.isCompatible(entity.getMediaType())) {
      throw new ActivitiIllegalArgumentException("The request should be of type" + MediaType.MULTIPART_FORM_DATA + ".");
    }
    RestletFileUpload upload=new RestletFileUpload(new DiskFileItemFactory());
    List<FileItem> items=upload.parseRepresentation(entity);
    FileItem uploadItem=null;
    for (    FileItem fileItem : items) {
      if (fileItem.getName() != null) {
        uploadItem=fileItem;
      }
    }
    if (uploadItem == null) {
      throw new ActivitiIllegalArgumentException("No file content was found in request body.");
    }
    DeploymentBuilder deploymentBuilder=ActivitiUtil.getRepositoryService().createDeployment();
    String fileName=uploadItem.getName();
    if (fileName.endsWith(".bpmn20.xml") || fileName.endsWith(".bpmn")) {
      deploymentBuilder.addInputStream(fileName,uploadItem.getInputStream());
    }
 else     if (fileName.toLowerCase().endsWith(".bar") || fileName.toLowerCase().endsWith(".zip")) {
      deploymentBuilder.addZipInputStream(new ZipInputStream(uploadItem.getInputStream()));
    }
 else {
      throw new ActivitiIllegalArgumentException("File must be of type .bpmn20.xml, .bpmn, .bar or .zip");
    }
    deploymentBuilder.name(fileName);
    Deployment deployment=deploymentBuilder.deploy();
    setStatus(Status.SUCCESS_CREATED);
    return getApplication(ActivitiRestServicesApplication.class).getRestResponseFactory().createDeploymentResponse(this,deployment);
  }
 catch (  Exception e) {
    if (e instanceof ActivitiException) {
      throw (ActivitiException)e;
    }
    throw new ActivitiException(e.getMessage(),e);
  }
}
