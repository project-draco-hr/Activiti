{
  DiagramLayout processDiagramLayout;
  if (1 == processDefinitionQuery.count()) {
    ProcessDefinition processDefinition=processDefinitionQuery.singleResult();
    assertNotNull(processDefinition);
    processDiagramLayout=repositoryService.getProcessDiagramLayout(processDefinition.getId());
  }
 else {
    InputStream bpmnXmlStream=new FileInputStream("src/test/resources/org/activiti/engine/test/api/repository/diagram/" + xmlFileName);
    InputStream imageStream=new FileInputStream("src/test/resources/org/activiti/engine/test/api/repository/diagram/" + imageFileName);
    assertNotNull(bpmnXmlStream);
    assertNotNull(imageStream);
    processDiagramLayout=new ProcessDiagramLayoutFactory().getProcessDiagramLayout(bpmnXmlStream,imageStream);
  }
  assertLayoutCorrect(processDiagramLayout);
}
