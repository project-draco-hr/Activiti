{
  try {
    Object delegate=expression.getValue(execution);
    ClassDelegate.applyFieldDeclaration(fieldDeclarations,delegate);
    if (delegate instanceof ActivityBehavior) {
      Context.getProcessEngineConfiguration().getDelegateInterceptor().handleInvocation(new ActivityBehaviorInvocation((ActivityBehavior)delegate,execution));
    }
 else     if (delegate instanceof JavaDelegate) {
      Context.getProcessEngineConfiguration().getDelegateInterceptor().handleInvocation(new JavaDelegateInvocation((JavaDelegate)delegate,execution));
      leave(execution);
    }
 else {
      throw new ActivitiException("Delegate expression " + expression + " did neither resolve to an implementation of "+ ActivityBehavior.class+ " nor "+ JavaDelegate.class);
    }
  }
 catch (  Exception exc) {
    Throwable cause=exc;
    BpmnError error=null;
    while (cause != null) {
      if (cause instanceof BpmnError) {
        error=(BpmnError)cause;
        break;
      }
      cause=cause.getCause();
    }
    if (error != null) {
      ErrorPropagation.propagateError(error,execution);
    }
 else {
      throw exc;
    }
  }
}
