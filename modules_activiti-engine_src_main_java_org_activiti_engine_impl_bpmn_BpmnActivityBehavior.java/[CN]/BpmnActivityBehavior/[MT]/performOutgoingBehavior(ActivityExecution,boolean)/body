{
  if (log.isLoggable(Level.FINE)) {
    log.fine("Leaving activity '" + execution.getActivity().getId() + "'");
  }
  List<PvmTransition> transitionsToTake=new ArrayList<PvmTransition>();
  List<PvmTransition> outgoingTransitions=execution.getActivity().getOutgoingTransitions();
  for (  PvmTransition outgoingTransition : outgoingTransitions) {
    Condition condition=(Condition)outgoingTransition.getProperty(BpmnParse.PROPERTYNAME_CONDITION);
    if (condition == null || !checkConditions || condition.evaluate(execution)) {
      transitionsToTake.add(outgoingTransition);
    }
  }
  if (transitionsToTake.size() == 1) {
    execution.take(transitionsToTake.get(0));
  }
 else   if (transitionsToTake.size() >= 1) {
    execution.inactivate();
    List<ActivityExecution> joinedExecutions=new ArrayList<ActivityExecution>();
    joinedExecutions.add(execution);
    execution.takeAll(transitionsToTake,joinedExecutions);
  }
 else   if (log.isLoggable(Level.FINE)) {
    log.fine("No outgoing sequence flow found for " + execution.getActivity().getId() + ". Ending execution.");
    execution.end();
  }
}
