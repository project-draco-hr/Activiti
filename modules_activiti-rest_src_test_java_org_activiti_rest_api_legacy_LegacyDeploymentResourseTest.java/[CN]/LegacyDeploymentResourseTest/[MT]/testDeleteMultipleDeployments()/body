{
  try {
    Deployment firstDeployment=repositoryService.createDeployment().name("Deployment 1").category("DEF").addClasspathResource("org/activiti/rest/api/repository/oneTaskProcess.bpmn20.xml").deploy();
    Deployment secondDeployment=repositoryService.createDeployment().name("Deployment 2").category("ABC").addClasspathResource("org/activiti/rest/api/repository/oneTaskProcess.bpmn20.xml").deploy();
    ClientResource client=getAuthenticatedClient("deployments/delete");
    ObjectNode requestNode=objectMapper.createObjectNode();
    ArrayNode deploymentIds=objectMapper.createArrayNode();
    deploymentIds.add(firstDeployment.getId());
    deploymentIds.add(secondDeployment.getId());
    requestNode.put("deploymentIds",deploymentIds);
    Representation response=client.post(requestNode);
    assertEquals(Status.SUCCESS_OK,client.getResponse().getStatus());
    JsonNode responseNode=objectMapper.readTree(response.getStream());
    assertEquals(Boolean.TRUE.booleanValue(),responseNode.get("success").asBoolean());
    assertEquals(0L,repositoryService.createDeploymentQuery().count());
  }
  finally {
    List<Deployment> deployments=repositoryService.createDeploymentQuery().list();
    for (    Deployment deployment : deployments) {
      repositoryService.deleteDeployment(deployment.getId(),true);
    }
  }
}
