{
  BeanDefinition definition=null;
  String beanName=null;
  if (value instanceof BeanDefinition) {
    definition=(BeanDefinition)value;
    beanName=BeanDefinitionReaderUtils.generateBeanName(definition,registry);
  }
 else   if (value instanceof BeanDefinitionHolder) {
    BeanDefinitionHolder holder=(BeanDefinitionHolder)value;
    definition=holder.getBeanDefinition();
    beanName=holder.getBeanName();
  }
  if (definition != null) {
    boolean nestedScoped=scope.equals(definition.getScope());
    boolean scopeChangeRequiresProxy=!scoped && nestedScoped;
    if (scopeChangeRequiresProxy) {
      return createScopedProxy(beanName,definition,registry,proxyTargetClass);
    }
  }
  value=super.resolveValue(value);
  return value;
}
