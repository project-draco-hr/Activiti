{
  if (SECURE_SCRIPT_CONTEXT_FACTORY == null) {
    SECURE_SCRIPT_CONTEXT_FACTORY=new SecureScriptContextFactory();
    SECURE_SCRIPT_CONTEXT_FACTORY.setOptimizationLevel(configurator.getScriptOptimizationLevel());
    if (configurator.isEnableClassWhiteListing() || configurator.getWhiteListedClasses() != null) {
      secureScriptClassShutter=new SecureScriptClassShutter();
      if (configurator.getWhiteListedClasses() != null && configurator.getWhiteListedClasses().size() > 0) {
        secureScriptClassShutter.setWhiteListedClasses(configurator.getWhiteListedClasses());
      }
      SECURE_SCRIPT_CONTEXT_FACTORY.setClassShutter(secureScriptClassShutter);
    }
    if (configurator.getMaxScriptExecutionTime() > 0L) {
      SECURE_SCRIPT_CONTEXT_FACTORY.setMaxScriptExecutionTime(configurator.getMaxScriptExecutionTime());
    }
    if (configurator.getMaxMemoryUsed() > 0L) {
      SECURE_SCRIPT_CONTEXT_FACTORY.setMaxMemoryUsed(configurator.getMaxMemoryUsed());
    }
    if (configurator.getMaxStackDepth() > 0) {
      SECURE_SCRIPT_CONTEXT_FACTORY.setMaxStackDepth(configurator.getMaxStackDepth());
    }
    if (configurator.getMaxScriptExecutionTime() > 0L || configurator.getMaxMemoryUsed() > 0L) {
      SECURE_SCRIPT_CONTEXT_FACTORY.setObserveInstructionCount(configurator.getNrOfInstructionsBeforeStateCheckCallback());
    }
    ContextFactory.initGlobal(SECURE_SCRIPT_CONTEXT_FACTORY);
  }
}
