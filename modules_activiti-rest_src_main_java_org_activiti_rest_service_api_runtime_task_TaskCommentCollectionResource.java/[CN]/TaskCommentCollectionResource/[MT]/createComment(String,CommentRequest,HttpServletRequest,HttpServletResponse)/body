{
  Task task=getTaskFromRequest(taskId);
  if (comment.getMessage() == null) {
    throw new ActivitiIllegalArgumentException("Comment text is required.");
  }
  String processInstanceId=null;
  if (comment.isSaveProcessInstanceId()) {
    Task taskEntity=taskService.createTaskQuery().taskId(task.getId()).singleResult();
    processInstanceId=taskEntity.getProcessInstanceId();
  }
  Comment createdComment=taskService.addComment(task.getId(),processInstanceId,comment.getMessage());
  response.setStatus(HttpStatus.SC_CREATED);
  String serverRootUrl=request.getRequestURL().toString();
  serverRootUrl=serverRootUrl.substring(0,serverRootUrl.indexOf("/runtime/tasks/"));
  return restResponseFactory.createRestComment(createdComment,serverRootUrl);
}
