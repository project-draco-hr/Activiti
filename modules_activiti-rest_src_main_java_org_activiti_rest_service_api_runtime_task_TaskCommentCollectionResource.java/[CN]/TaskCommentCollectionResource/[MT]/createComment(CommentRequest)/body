{
  if (!authenticate())   return null;
  Task task=getTaskFromRequest();
  if (comment.getMessage() == null) {
    throw new ActivitiIllegalArgumentException("Comment text is required.");
  }
  TaskService taskService=ActivitiUtil.getTaskService();
  String processInstanceId=null;
  if (comment.isSaveProcessInstanceId()) {
    Task taskEntity=taskService.createTaskQuery().taskId(task.getId()).singleResult();
    processInstanceId=taskEntity.getProcessInstanceId();
  }
  Comment createdComment=taskService.addComment(task.getId(),processInstanceId,comment.getMessage());
  setStatus(Status.SUCCESS_CREATED);
  return getApplication(ActivitiRestServicesApplication.class).getRestResponseFactory().createRestComment(this,createdComment);
}
