{
  RepositorySession repositorySession=commandContext.getRepositorySession();
  ProcessDefinitionEntity processDefinition=null;
  TaskEntity task=null;
  ExecutionEntity execution=null;
  String formResourceKey=null;
  if (taskId != null) {
    task=commandContext.getTaskSession().findTaskById(taskId);
    execution=task.getExecution();
    processDefinition=(ProcessDefinitionEntity)execution.getProcessDefinition();
    if (task == null) {
      throw new ActivitiException("No task found for id = '" + taskId + "'");
    }
    formResourceKey=task.getFormResourceKey();
  }
 else   if (processDefinitionId != null) {
    processDefinition=repositorySession.findDeployedProcessDefinitionById(processDefinitionId);
    if (processDefinition == null) {
      throw new ActivitiException("No process definition found for id = '" + processDefinitionId + "'");
    }
    formResourceKey=processDefinition.getStartFormResourceKey();
  }
 else   if (processDefinitionKey != null) {
    processDefinition=repositorySession.findDeployedLatestProcessDefinitionByKey(processDefinitionKey);
    if (processDefinition == null) {
      throw new ActivitiException("No process definition found for key '" + processDefinitionKey + "'");
    }
    formResourceKey=processDefinition.getStartFormResourceKey();
  }
  String deploymentId=processDefinition.getDeploymentId();
  DeploymentEntity deployment=repositorySession.findDeploymentById(deploymentId);
  Object result=null;
  if (formResourceKey != null) {
    String formTemplateString=getFormTemplateString(formResourceKey,deployment);
    ScriptingEngines scriptingEngines=commandContext.getProcessEngineConfiguration().getScriptingEngines();
    result=scriptingEngines.evaluate(formTemplateString,ScriptingEngines.DEFAULT_SCRIPTING_LANGUAGE,execution);
  }
  return result;
}
