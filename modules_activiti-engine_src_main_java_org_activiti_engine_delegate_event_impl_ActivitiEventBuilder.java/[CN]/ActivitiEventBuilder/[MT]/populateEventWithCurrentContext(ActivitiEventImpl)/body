{
  if (Context.isExecutionContextActive()) {
    ExecutionContext executionContext=Context.getExecutionContext();
    if (executionContext != null) {
      event.setExecutionId(executionContext.getExecution().getId());
      event.setProcessInstanceId(executionContext.getExecution().getProcessInstanceId());
      event.setProcessDefinitionId(executionContext.getExecution().getProcessDefinitionId());
    }
  }
 else {
    if (event instanceof ActivitiEntityEvent) {
      Object persistendObject=((ActivitiEntityEvent)event).getEntity();
      if (persistendObject instanceof Job) {
        event.setExecutionId(((Job)persistendObject).getExecutionId());
        event.setProcessInstanceId(((Job)persistendObject).getProcessInstanceId());
        event.setProcessDefinitionId(((Job)persistendObject).getProcessDefinitionId());
      }
 else       if (persistendObject instanceof ExecutionEntity) {
        event.setExecutionId(((ExecutionEntity)persistendObject).getId());
        event.setProcessInstanceId(((ExecutionEntity)persistendObject).getProcessInstanceId());
        event.setProcessDefinitionId(((ExecutionEntity)persistendObject).getProcessDefinitionId());
      }
    }
  }
}
