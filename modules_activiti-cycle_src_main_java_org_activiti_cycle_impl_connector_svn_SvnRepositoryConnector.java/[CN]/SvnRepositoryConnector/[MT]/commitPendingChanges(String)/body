{
synchronized (transaction_lock) {
    if (!transactionActive) {
      throw new RuntimeException("No transaction active");
    }
  }
  ISVNClientAdapter clientAdapter=getSvnClientAdapter();
  try {
    clientAdapter.commit(dirtyFolders.toArray(new File[0]),comment,true);
synchronized (transaction_lock) {
      transactionActive=false;
    }
  }
 catch (  SVNClientException e) {
    log.log(Level.SEVERE,"Could not commit changes in " + dirtyFolders.toArray(new File[0]) + " "+ e.getMessage());
    cancelTransaction();
    throw new RepositoryException("Could not commit changes in " + dirtyFolders.toArray(new File[0]),e);
  }
 finally {
    dirtyFolders.clear();
  }
}
